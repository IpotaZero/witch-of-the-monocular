{"version":3,"mappings":"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","names":["SceneAdventure","Scene","#pages","Pages","#setup","LocalStorage","SceneTitle","__vitePreload","n","Scenes","Serif","items","Awaits","Dom","#update","getItem","item","SceneGame","page","html","qs","link","hidden","itemSerif","c"],"ignoreList":[],"sources":["../../../src/Scenes/SceneAdventure1.ts"],"sourcesContent":["import { Dom } from \"../Dom\"\r\nimport { Item, LocalStorage } from \"../LocalStorage\"\r\nimport { Awaits } from \"../utils/Awaits\"\r\nimport { BGM } from \"../utils/BGM\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Serif } from \"../utils/Serif\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class SceneAdventure extends Scene {\r\n    ready: Promise<void>\r\n\r\n    #pages = new Pages()\r\n\r\n    constructor() {\r\n        super()\r\n        this.ready = this.#setup()\r\n    }\r\n\r\n    async end(): Promise<void> {\r\n        LocalStorage.setCurrentBranch(this.#pages.getCurrentBranch())\r\n    }\r\n\r\n    async #setup() {\r\n        this.#pages.before(\"title\", async () => {\r\n            this.#pages.shaveBranch(1)\r\n\r\n            const { SceneTitle } = await import(\"./SceneTitle\")\r\n\r\n            await Scenes.goto(() => new SceneTitle())\r\n\r\n            return true\r\n        })\r\n\r\n        this.#pages.on(\"first\", () => {\r\n            if (LocalStorage.getFlags().includes(\"2階\")) return\r\n            LocalStorage.addFlag(\"2階\")\r\n\r\n            Serif.say(\"私の部屋に行けば何とかなるはず。探してみて!\")\r\n        })\r\n\r\n        this.#pages.before(\"寝室\", async () => {\r\n            if (LocalStorage.getFlags().includes(\"寝室開放\")) return\r\n\r\n            const items = LocalStorage.getItems()\r\n\r\n            if (items.includes(\"ヘアピン\") && items.includes(\"魔導書\")) {\r\n                Serif.say(\"(魔導書に載っていた魔術でヘアピンをカギに変えて開けた。)\", \"黒魔術の才能がありそうだねえ。\")\r\n                await Serif.wait()\r\n                LocalStorage.addFlag(\"寝室開放\")\r\n            } else if (items.includes(\"ハンマー\")) {\r\n                Serif.say(\"(ハンマーで鍵をブッ壊した。)\", \"やるねえ。\")\r\n                await Serif.wait()\r\n                LocalStorage.addFlag(\"寝室開放\")\r\n            } else if (items.includes(\"ぬるついたハンマー\")) {\r\n                Serif.say(\"ハンマー? そんなぬるぬるじゃあ危ないよ。\")\r\n                await Serif.wait()\r\n                return true\r\n            } else {\r\n                Serif.say(\"(鍵がかかっている。)\", \"壊すための道具を探すか、鍵を探すかかな。\")\r\n                await Serif.wait()\r\n                return true\r\n            }\r\n        })\r\n\r\n        // serif\r\n        this.#pages.on(\"寝室\", async () => {\r\n            if (!LocalStorage.getFlags().includes(\"寝室\")) {\r\n                Serif.say(\"そこの窓から外に出られるはず。大丈夫! 下は柔らかい土だから。\")\r\n                await Serif.wait()\r\n                LocalStorage.addFlag(\"寝室\")\r\n            }\r\n        })\r\n\r\n        this.#pages.before(\"ベッド\", async () => {\r\n            Serif.say(\"(黴臭いベッド。)\", \"最近こっちに来てないから。。。\")\r\n            await Serif.wait()\r\n            return true\r\n        })\r\n\r\n        this.#pages.before(\"ベッド下\", async () => {\r\n            Serif.say(\"あーっ! 覗くな!\")\r\n        })\r\n\r\n        this.#pages.before(\"窓\", async () => {\r\n            Serif.say(\"(!)\", \"(足を踏み出した瞬間突然床が抜け落ちた!)\")\r\n            await Serif.wait()\r\n            await Scenes.goto(() => new SceneAdventure())\r\n        })\r\n\r\n        this.#pages.before(\"本棚\", async () => {\r\n            Serif.say(\"(「グラフ理論入門」、「線形代数と数え上げ」、「幾何学I」......)\")\r\n            await Serif.wait()\r\n            return true\r\n        })\r\n\r\n        this.#pages.before(\"湯舟\", async () => {\r\n            if (LocalStorage.getFlags().includes(\"お風呂\")) {\r\n                Serif.say(\"(もう入った。)\")\r\n                await Serif.wait()\r\n            } else {\r\n                Serif.say(\"(空っぽの湯舟。)\", \"入る?\", \"(入ることにした。)\")\r\n                await Serif.wait()\r\n                await Awaits.fadeOut(Dom.container, 1000)\r\n                await Awaits.fadeIn(Dom.container, 1000)\r\n                Serif.say(\"(いい湯だった。)\")\r\n                await Serif.wait()\r\n                LocalStorage.addFlag(\"お風呂\")\r\n            }\r\n\r\n            return true\r\n        })\r\n\r\n        this.#pages.before(\"おトイレ\", async () => {\r\n            if (LocalStorage.getFlags().includes(\"おトイレ\")) {\r\n                Serif.say(\"(もうした。)\")\r\n                await Serif.wait()\r\n            } else {\r\n                Serif.say(\"あー。一旦監視切るね。\")\r\n                await Serif.wait()\r\n                await Awaits.fadeOut(Dom.container, 1000)\r\n                await Awaits.fadeIn(Dom.container, 1000)\r\n                Serif.say(\"おかえりっ。\")\r\n                await Serif.wait()\r\n                LocalStorage.addFlag(\"おトイレ\")\r\n            }\r\n\r\n            return true\r\n        })\r\n        // serif end\r\n\r\n        this.#pages.before(\"石鹸\", async () => {\r\n            if (LocalStorage.getItems().includes(\"ぬるついたハンマー\")) {\r\n                Serif.say(\"(ハンマーを洗った。)\")\r\n                await Serif.wait()\r\n\r\n                LocalStorage.removeItem(\"ぬるついたハンマー\")\r\n                LocalStorage.addItem(\"ハンマー\")\r\n\r\n                this.#update()\r\n            } else {\r\n                Serif.say(\"(ボディソープ等。)\")\r\n                await Serif.wait()\r\n            }\r\n\r\n            return true\r\n        })\r\n\r\n        const getItem: Item[] = [\"ぬるついたハンマー\", \"ヘアピン\", \"魔導書\", \"薄い本\"]\r\n\r\n        getItem.forEach((item) => {\r\n            this.#pages.before(\"get-\" + item, async () => {\r\n                this.#pages.shaveBranch(1)\r\n\r\n                const { SceneGame } = await import(\"./SceneGame\")\r\n                await Scenes.goto(() => new SceneGame(item, { from: \"adventure\" }), { mode: \"fade\" })\r\n\r\n                return true\r\n            })\r\n        })\r\n\r\n        getItem.forEach((item) => {\r\n            this.#pages.on(\"clear-\" + item, async (page) => {\r\n                LocalStorage.addItem(item)\r\n                this.#update()\r\n                page.back(1, { msIn: 0, msOut: 0 })\r\n\r\n                Serif.say(`(${item}を手に入れた。)`)\r\n            })\r\n        })\r\n\r\n        const html = await (await fetch(\"pages/adventure1.html\")).text()\r\n        await this.#pages.load(Dom.container, html, { history: LocalStorage.getCurrentBranch() })\r\n\r\n        this.#update()\r\n    }\r\n\r\n    #update() {\r\n        const qs = (link: string, hidden: boolean) =>\r\n            Dom.container.querySelector<HTMLElement>(`[data-link=\"${link}\"]`)?.classList.toggle(\"hidden\", hidden)\r\n\r\n        const itemSerif: Partial<Record<Item, string>> = {\r\n            \"1階のカギ\": \"(玄関のすぐ奥の扉の鍵。......2重扉?)\",\r\n            \"包丁\": \"(軽くて扱いやすい包丁。)\",\r\n            \"ライター\": \"(よくあるライター。オイルは十分)\",\r\n            \"空のバケツ\": \"(何の変哲もないバケツ。)\",\r\n            \"水の入ったバケツ\": \"(水の入ったバケツ。地味に重い。)\",\r\n            \"ぬるついたハンマー\": \"(滑って使えそうにない。)\",\r\n            \"ハンマー\": \"(鍵もブッ壊せそうなハンマー。)\",\r\n            \"ヘアピン\": \"(技術があればピッキングできそう。)\",\r\n            \"魔導書\": \"(物体を変質させる魔法が書いてある。)\",\r\n            \"薄い本\": \"しばくぞ。\",\r\n        }\r\n\r\n        ;[...Dom.container.querySelector(\"#item\")!.children]\r\n            .filter((c) => !c.hasAttribute(\"data-back\"))\r\n            .forEach((c) => c.remove())\r\n\r\n        LocalStorage.getItems().forEach((item) => {\r\n            qs(item, true)\r\n\r\n            Dom.container.querySelector(\"#item\")!.innerHTML += `<button data-link=\"item-${item}\">${item}</button>`\r\n\r\n            this.#pages.before(`item-${item}`, async () => {\r\n                Serif.say(itemSerif[item] ?? \"エラー\")\r\n                return true\r\n            })\r\n        })\r\n\r\n        if (LocalStorage.getItems().includes(\"ハンマー\")) {\r\n            qs(\"ぬるついたハンマー\", true)\r\n        }\r\n\r\n        this.#pages.updateButtons()\r\n\r\n        Dom.container.querySelector<HTMLElement>(\"#update\")!.onclick = async () => {\r\n            LocalStorage.setCurrentBranch(this.#pages.getCurrentBranch())\r\n            this.#setup()\r\n        }\r\n    }\r\n}\r\n"],"file":"assets/SceneAdventure1-CzFOA_aV.js"}