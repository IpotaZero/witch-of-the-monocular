const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneAdventure0-CluFZDqg.js","../run.js","./SceneAdventure1-C6NVCSBM.js","./SceneAdventure2-Bcz4VgFM.js","./SceneGame-WW1LIIrD.js"])))=>i.map(i=>d[i]);
import{S as _,P as O,D as d,a as u,b as m,_ as l,c as S,A as y}from"../run.js";const I=["1階のカギ","包丁","ライター","空のバケツ","鉢"],v=["ぬるついたハンマー","ヘアピン","魔導書","造花","葛"],w=["ガラス瓶","楽譜","金属片","朽ち果てたメモ","魔女"],V={"1階のカギ":"(玄関のすぐ奥の扉の鍵。......2重扉?)",包丁:"(軽くて扱いやすい包丁。)",ライター:"(よくあるライター。オイルは十分)",空のバケツ:"(何の変哲もないバケツ。)",水の入ったバケツ:"(水の入ったバケツ。地味に重い。)",鉢:"(何かが咲いていたはずの鉢。)",ぬるついたハンマー:"(油で滑って使えそうにない。)",ハンマー:"(鍵もブッ壊せそうなハンマー。)",ヘアピン:"(技術があればピッキングできそう。)",魔導書:"(物体を変質させる魔法が書いてある。)",造花:"(紙でできた紫の花。)",葛:"(日陰に追いやられている。)",ガラス瓶:"(叩くと心地よい音が鳴る。)",金属片:"(何かの成れの果て。)",楽譜:"(知らないはずなのに見るとメロディが流れてくる。)",ベル:"(少し鈍い。)",朽ち果てたメモ:"(魔女への恨み言が書かれている。)",魔女:"(ひとやしきの魔女。)"};class c{static getChapter(){const t=localStorage.getItem("chapter");return t?JSON.parse(t):0}static setChapter(t){localStorage.setItem("chapter",`${t}`)}static getCurrentBranch(){const t=localStorage.getItem("current-branch");return t?JSON.parse(t):[]}static setCurrentBranch(t){localStorage.setItem("current-branch",JSON.stringify(t))}static addBranch(t){const e=this.getCurrentBranch();e.push(t),this.setCurrentBranch(e)}static getItems(){const t=localStorage.getItem("items");return t?JSON.parse(t):[]}static setItems(t){localStorage.setItem("items",JSON.stringify(t))}static removeItem(t){const e=this.getItems();this.setItems(e.filter(a=>a!==t))}static addItem(t){const e=this.getItems();e.includes(t)||(e.push(t),this.setItems(e))}static getFlags(){const t=localStorage.getItem("flags");return t?JSON.parse(t):[]}static setFlags(t){localStorage.setItem("flags",JSON.stringify(t))}static addFlag(t){const e=this.getFlags();e.push(t),this.setFlags(e)}static addClearedStageId(t){const e=this.getClearedStageId();e.includes(t)||(e.push(t),localStorage.setItem("cleared-stages",JSON.stringify(e)))}static getClearedStageId(){const t=localStorage.getItem("cleared-stages");return t?JSON.parse(t):[]}static getVolume(){const t=localStorage.getItem("volume");return t?JSON.parse(t):{bgm:9,se:9}}static setVolume(t){localStorage.setItem("volume",JSON.stringify(t))}static set isCleared(t){localStorage.setItem("is-cleared",t+"")}static get isCleared(){const t=localStorage.getItem("is-cleared");return t?!!t:!1}}class o{static#t=new AudioContext;static#r=this.#t.createGain();static#o=1;static#e=null;static{this.#r.connect(this.#t.destination)}#i;#a;#n=1;#c;#s=null;#l=!1;constructor(t,e){this.#i=t,this.#n=e.volume??1,this.#a=o.#t.createGain(),this.#a.gain.value=this.#n,this.#a.connect(o.#r),this.#c=this.#u(e)}async#u(t){const a=await(await fetch(this.#i)).arrayBuffer(),s=await o.#t.decodeAudioData(a);this.#s=o.#t.createBufferSource(),this.#s.buffer=s,this.#s.loopStart=t.loopStartS??0,this.#s.loopEnd=t.loopEndS??s.duration,this.#s.loop=t.loop??!0,this.#s.connect(this.#a)}async#m(t){this.#a.gain.setValueAtTime(this.#n,o.#t.currentTime),this.#a.gain.linearRampToValueAtTime(0,o.#t.currentTime+t/1e3),await new Promise(e=>setTimeout(e,t)),this.#a.disconnect(),this.#l&&this.#s?.stop(),this.#s?.disconnect()}static getPath(){return this.#e?this.#e.#i:""}static async ffp(t,e={}){await Promise.all([this.#d(1e3),this.#h(t,e)]),this.getPath()===t&&this.#g(e.when??0)}static async#h(t,e){this.#e=new o(t,e),await this.#e.#c}static#g(t){this.#e&&(this.#e.#s?.start(this.#t.currentTime+t),this.#e.#l=!0)}static setVolume(t){this.#o=t,this.#r.gain.value=this.#o}static async#d(t){this.#e&&await this.#e.#m(t)}}window.BGM=o;class p extends _{ready;#t=new O;constructor(t){super(),this.ready=this.#r(t)}async#r(t){const e=await(await fetch("pages/title.html")).text();await this.#t.load(d.container,e,{history:t}),o.ffp("assets/sounds/title.mp3"),this.#t.on("start",async()=>{if(c.isCleared){c.getClearedStageId().includes("魔女")?u.say("(あれからあの屋敷の話は聞かない。)","(核となる魔女がいなくなり、力を失ったのか。)","(屋敷で見つけたものはまだ手元にある。)","(それだけがあの日の出来事を証明するだろう。)"):u.say("(あの屋敷には、きっとまだ囚われたものがあるのだろう。)","(あなたはもし時を戻せたら、と思った。)"),await u.wait(),this.#t.back(1);return}const s=Object.assign({"./SceneAdventure0.ts":()=>l(()=>import("./SceneAdventure0-CluFZDqg.js"),__vite__mapDeps([0,1]),import.meta.url),"./SceneAdventure1.ts":()=>l(()=>import("./SceneAdventure1-C6NVCSBM.js"),__vite__mapDeps([2,1]),import.meta.url),"./SceneAdventure2.ts":()=>l(()=>import("./SceneAdventure2-Bcz4VgFM.js"),__vite__mapDeps([3,1]),import.meta.url)}),r=`./SceneAdventure${c.getChapter()}.ts`,{SceneAdventure:n}=await s[r]();await m.goto(()=>new n,{msIn:400,msOut:800})}),this.#t.before("fullscreen",async()=>(document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen(),!0)),[...I,...v,...w].forEach(s=>{this.#t.before(s,async()=>{const{SceneGame:r}=await l(async()=>{const{SceneGame:n}=await import("./SceneGame-WW1LIIrD.js");return{SceneGame:n}},__vite__mapDeps([4,1]),import.meta.url);return await m.goto(()=>new r(s,{from:"title"}),{mode:"fade"}),!0})}),this.#e(),this.#i(),this.#o(),this.#t.updateButtons()}#o(){const t=this.#t.pages.get("first");for(let a=0;a<16;a++){const s=new Image;s.src="assets/images/particle0.png",s.classList.add("particle0");const r=Math.random()**2*24;s.style.animationDelay=`${Math.random()*8}s`,s.style.width=`${r+16}vh`,s.style.animationDuration=`${Math.random()*4+8}s`,s.style.aspectRatio="1",s.style.position="absolute",s.style.left=`${10+80*(a/16)}%`,s.style.setProperty("--rotation",Math.random()>.5?"-1":"1"),t.appendChild(s)}const e=new Image;e.src="assets/images/particle1.png",this.#t.pages.getValues().forEach(a=>{a.addEventListener("click",s=>{const r=s.target.getBoundingClientRect(),n=s.clientX-r.left,b=s.clientY-r.top;for(let h=0;h<8;h++){const i=e.cloneNode();i.style.position="fixed",i.style.pointerEvents="none",i.style.left=`calc(${r.left+n}px - 4dvh)`,i.style.top=`calc(${r.top+b}px - 4dvh)`,i.style.width="8dvh",i.style.height="8dvh",i.style.scale=""+(Math.random()/2+.8),i.style.opacity=""+Math.random()*.5,i.style.transition="transform 1s ease-out, opacity 1s ease-out",i.style.zIndex="1000",document.body.appendChild(i);const g=Math.PI*2*h/8+Math.random(),f=60+Math.random()*20;requestAnimationFrame(()=>{i.style.transform=`translate(${Math.cos(g)*f/8}dvh, ${Math.sin(g)*f/8}dvh) scale(0.5) rotate(${g/Math.PI*180*(Math.random()-.5)}deg)`,i.style.opacity="0"}),setTimeout(()=>{i.remove()},1e3)}})})}#e(){const t=[...I,...v,...w],e=this.#t.pages.get("past"),a=c.getClearedStageId();t.forEach(s=>{a.includes(s)?(e.innerHTML+=`<button data-link="stage-${s}">${s}</button>`,this.#t.before(`stage-${s}`,async()=>{const{SceneGame:r}=await l(async()=>{const{SceneGame:n}=await import("./SceneGame-WW1LIIrD.js");return{SceneGame:n}},__vite__mapDeps([4,1]),import.meta.url);await m.goto(()=>new r(s,{from:"title"}),{mode:"fade"})})):e.innerHTML+=`<button data-link="stage-${s}" class="uncleared-stage">${s}</button>`})}#i(){const{bgm:t,se:e}=c.getVolume(),a=d.container.querySelector("#bgm-volume"),s=d.container.querySelector("#se-volume");a.value=""+t,s.value=""+e,o.setVolume(t/9),S.setVolume(e/9/2),a.oninput=()=>{o.setVolume(+a.value/9),c.setVolume({bgm:+a.value,se:+s.value})},s.oninput=()=>{S.setVolume(+s.value/9/2),c.setVolume({bgm:+a.value,se:+s.value})},this.#t.before("delete-adventure-data",async()=>(await y.ask(["本当に消す","消さない"])==="本当に消す"&&(localStorage.removeItem("flags"),localStorage.removeItem("items"),localStorage.removeItem("chapter"),localStorage.removeItem("current-branch"),localStorage.removeItem("is-cleared"),u.say("(忘れた。)")),!0)),this.#t.before("delete-data",async()=>(await y.ask(["本当に消す","消さない"])==="本当に消す"&&(localStorage.clear(),await m.goto(()=>new p)),!0))}}const A=Object.freeze(Object.defineProperty({__proto__:null,SceneTitle:p},Symbol.toStringTag,{value:"Module"}));export{o as B,c as L,A as S,v as a,w as b,I as g,V as i};
//# sourceMappingURL=SceneTitle-DVdCZsuk.js.map
