{"version":3,"mappings":"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","names":["SceneAdventure","Scene","#pages","Pages","#setup","LocalStorage","Serif","page","getItem","item","SceneGame","__vitePreload","Scenes","#update","items","#nextChapter","SceneTitle","n","html","Dom","serifMap","b","serif","SceneAdventure2","qs","link","hidden","itemSerif","c"],"ignoreList":[],"sources":["../../../src/Scenes/SceneAdventure0.ts"],"sourcesContent":["import { Dom } from \"../Dom\"\r\nimport { Item, LocalStorage } from \"../LocalStorage\"\r\nimport { BGM } from \"../utils/BGM\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Serif } from \"../utils/Serif\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class SceneAdventure extends Scene {\r\n    ready: Promise<void>\r\n\r\n    #pages = new Pages()\r\n\r\n    constructor() {\r\n        super()\r\n        this.ready = this.#setup()\r\n    }\r\n\r\n    async end(): Promise<void> {\r\n        LocalStorage.setCurrentBranch(this.#pages.getCurrentBranch())\r\n    }\r\n\r\n    async #setup() {\r\n        this.#pages.on(\"first\", async () => {\r\n            if (LocalStorage.getFlags().includes(\"あらすじ\")) return\r\n            LocalStorage.addFlag(\"あらすじ\")\r\n\r\n            Serif.say(\r\n                '(森の中にある洋館、通称\"ひとやしき\"にはある噂があった。)',\r\n                \"(そこには恐ろしい魔女がいて、一度入れば決して出てこられないというもの。)\",\r\n                \"(あなたは最近この辺りに引っ越してきたばかりでその噂を知らず、森の中で迷った挙句その屋敷に入ってしまったのであった......。)\",\r\n            )\r\n\r\n            await Serif.wait()\r\n        })\r\n\r\n        this.#pages.on(\"room-0\", () => {\r\n            if (LocalStorage.getFlags().includes(\"met\")) return\r\n            LocalStorage.addFlag(\"met\")\r\n\r\n            Serif.say(\r\n                \"(頭の中から笑い声が聞こえる。)\",\r\n                \"くすくす......\",\r\n                \"この家に入ってきちゃうなんて、君は本当に馬鹿だねえ......\",\r\n                \"とはいえ鍵をかけてなかった私も悪い。\",\r\n                \"よって、君がこの家を出られるよう、手助けをしてあげよう。\",\r\n                \"私は今手が離せないから、そっちには行けないけどね。\",\r\n                \"さあ、そこの扉をくぐって......\",\r\n            )\r\n        })\r\n\r\n        this.#pages.on(\"room-1\", () => {\r\n            if (LocalStorage.getFlags().includes(\"1st\")) return\r\n\r\n            LocalStorage.addFlag(\"1st\")\r\n            Serif.say(\"2階から外に出る方法があるんだ。<br>まずは階段を探そう。\")\r\n        })\r\n\r\n        this.#pages.on(\"1階のカギ\", (page) => {\r\n            Serif.say(\r\n                \"そうそう、この家の物には盗難防止の魔法がかかっているから、手に入れるためには魔法を解かなくちゃいけないんだ。\",\r\n                \"すべての道具を使う必要はないかもしれないけど、見つけたものは持っていって構わないよ。\",\r\n                \"まあ百聞は一見に如かず。一緒に解いてみよう!\",\r\n            )\r\n        })\r\n\r\n        const getItem: Item[] = [\"1階のカギ\", \"包丁\", \"ライター\", \"空のバケツ\"]\r\n\r\n        getItem.forEach((item) => {\r\n            this.#pages.before(\"get-\" + item, async () => {\r\n                this.#pages.shaveBranch(1)\r\n\r\n                const { SceneGame } = await import(\"./SceneGame\")\r\n                await Scenes.goto(() => new SceneGame(item, { from: \"adventure\" }), { mode: \"fade\" })\r\n\r\n                return true\r\n            })\r\n        })\r\n\r\n        this.#pages.before(\"get-1階のカギ\", async (page) => {\r\n            this.#pages.shaveBranch(1)\r\n\r\n            const { SceneGame } = await import(\"./SceneGame\")\r\n            await Scenes.goto(() => new SceneGame(\"1階のカギ\", { from: \"adventure\" }), { mode: \"fade\" })\r\n            Serif.say(\r\n                \"さて、ではこの魔法陣の説明をしよう。\",\r\n                \"各マスの中に2つ数字があるのが見えるかな?\",\r\n                \"左上の数字はそこに入るべき数字。真ん中の数字は今入っている数字だよ。\",\r\n                \"何も入っていないマスがあるのには気づいたかな?\",\r\n                \"この空白マスには線でつながった別のマスの数字をスライドさせることが出来るんだ。\",\r\n                \"線をクリックしてスライドして、すべてのマスの左上と中の数字を一致させてみよう!\",\r\n            )\r\n\r\n            return true\r\n        })\r\n\r\n        getItem.forEach((item) => {\r\n            this.#pages.on(\"clear-\" + item, async (page) => {\r\n                LocalStorage.addItem(item)\r\n                this.#update()\r\n                page.back(1, { msIn: 0, msOut: 0 })\r\n\r\n                Serif.say(`(${item}を手に入れた。)`)\r\n            })\r\n        })\r\n\r\n        this.#pages.before(\".*\", async () => {\r\n            Serif.hide()\r\n        })\r\n\r\n        this.#pages.before(\"水バケツ\", async () => {\r\n            if (LocalStorage.getItems().includes(\"空のバケツ\")) {\r\n                LocalStorage.removeItem(\"空のバケツ\")\r\n                LocalStorage.addItem(\"水の入ったバケツ\")\r\n                Serif.say(\"(バケツに水を入れた。)\")\r\n            } else {\r\n                Serif.say(\"(水は出そうだ。)\")\r\n            }\r\n\r\n            await Serif.wait()\r\n\r\n            return true\r\n        })\r\n\r\n        this.#pages.before(\"room-1\", async (page) => {\r\n            if (LocalStorage.getItems().includes(\"1階のカギ\")) {\r\n                if (!LocalStorage.getFlags().includes(\"key-0\")) {\r\n                    Serif.say(\"(鍵を開けた。)\")\r\n                    await Serif.wait()\r\n                    LocalStorage.addFlag(\"key-0\")\r\n                }\r\n                return false\r\n            } else {\r\n                Serif.say(\"(鍵がかかっている。)\", \"あれ、その辺りに鍵はあるかな?\")\r\n                return true\r\n            }\r\n        })\r\n\r\n        this.#pages.on(\"階段-不\", async () => {\r\n            const items = LocalStorage.getItems()\r\n\r\n            if (items.includes(\"ライター\") && items.includes(\"水の入ったバケツ\")) {\r\n                Serif.say(\"(ツタを燃やしてバケツの水で消火した。)\")\r\n                LocalStorage.removeItem(\"水の入ったバケツ\")\r\n                LocalStorage.addItem(\"空のバケツ\")\r\n                LocalStorage.addFlag(\"ツタを切った\")\r\n                await Serif.wait()\r\n                this.#nextChapter()\r\n            } else if (items.includes(\"包丁\")) {\r\n                Serif.say(\"(包丁でツタを切った。)\")\r\n                LocalStorage.addFlag(\"ツタを切った\")\r\n                await Serif.wait()\r\n                this.#nextChapter()\r\n            } else if (items.includes(\"ライター\")) {\r\n                Serif.say(\"ツタを燃やすの? 消火用の何かがあればいいんだけど......。\")\r\n                await Serif.wait()\r\n            } else {\r\n                Serif.say(\"えぇっ!? ツタが伸びまくってるじゃん!?\", \"何か道具を探さなくちゃね。\")\r\n            }\r\n        })\r\n\r\n        this.#pages.before(\"title\", async () => {\r\n            this.#pages.shaveBranch(1)\r\n\r\n            const { SceneTitle } = await import(\"./SceneTitle\")\r\n\r\n            await Scenes.goto(() => new SceneTitle())\r\n\r\n            return true\r\n        })\r\n\r\n        const html = await (await fetch(\"pages/adventure0.html\")).text()\r\n        await this.#pages.load(Dom.container, html, { history: LocalStorage.getCurrentBranch() })\r\n\r\n        const serifMap: Record<string, string[]> = {\r\n            \"観葉植物\": [\"(観葉植物。)\", \"日当たりが悪くてげっそりしてるけど、世話はしてるよ。\"],\r\n            \"手が届かない\": [\"(手が届かない。)\", \"そこには何もないと思うよ。\"],\r\n            \"皿が入っている\": [\"(皿が入っている。)\"],\r\n            \"絵\": [\"(冒涜的な何かを感じる絵。)\", \"これはね、神様だよ。\"],\r\n        }\r\n\r\n        Dom.container.querySelectorAll(\".serif\").forEach((b) => {\r\n            const serif = b.getAttribute(\"data-link\")!\r\n\r\n            this.#pages.before(serif, async () => {\r\n                Serif.say(...serifMap[serif])\r\n                await Serif.wait()\r\n                return true\r\n            })\r\n        })\r\n\r\n        // Dom.container.querySelector<HTMLElement>(\"#back\")!.onclick = () => {\r\n        //     this.#pages.back(1)\r\n        // }\r\n\r\n        this.#update()\r\n    }\r\n\r\n    async #nextChapter() {\r\n        LocalStorage.setChapter(1)\r\n        this.#pages.shaveBranch(4)\r\n\r\n        const { SceneAdventure } = await import(\"./SceneAdventure1\")\r\n        Scenes.goto(() => new SceneAdventure())\r\n    }\r\n\r\n    #update() {\r\n        const qs = (link: string, hidden: boolean) =>\r\n            Dom.container.querySelector<HTMLElement>(`[data-link=\"${link}\"]`)?.classList.toggle(\"hidden\", hidden)\r\n\r\n        const itemSerif: Partial<Record<Item, string>> = {\r\n            \"1階のカギ\": \"(玄関のすぐ奥の扉の鍵。......2重扉?)\",\r\n            \"包丁\": \"(軽くて扱いやすい包丁。)\",\r\n            \"ライター\": \"(よくあるライター。オイルは十分)\",\r\n            \"空のバケツ\": \"(何の変哲もないバケツ。)\",\r\n            \"水の入ったバケツ\": \"(水の入ったバケツ。地味に重い。)\",\r\n        }\r\n\r\n        ;[...Dom.container.querySelector(\"#item\")!.children]\r\n            .filter((c) => !c.hasAttribute(\"data-back\"))\r\n            .forEach((c) => c.remove())\r\n\r\n        LocalStorage.getItems().forEach((item) => {\r\n            qs(item, true)\r\n\r\n            Dom.container.querySelector(\"#item\")!.innerHTML += `<button data-link=\"item-${item}\">${item}</button>`\r\n\r\n            this.#pages.before(`item-${item}`, async () => {\r\n                Serif.say(itemSerif[item] ?? \"エラー\")\r\n                return true\r\n            })\r\n        })\r\n\r\n        qs(\r\n            \"空のバケツ\",\r\n            LocalStorage.getItems().includes(\"空のバケツ\") || LocalStorage.getItems().includes(\"水の入ったバケツ\"),\r\n        )\r\n        qs(\"階段-不\", LocalStorage.getFlags().includes(\"ツタを切った\"))\r\n        qs(\"階段-可\", !LocalStorage.getFlags().includes(\"ツタを切った\"))\r\n\r\n        this.#pages.updateButtons()\r\n\r\n        Dom.container.querySelector<HTMLElement>(\"#update\")!.onclick = async () => {\r\n            LocalStorage.setCurrentBranch(this.#pages.getCurrentBranch())\r\n            this.#setup()\r\n        }\r\n    }\r\n}\r\n"],"file":"assets/SceneAdventure0-Bys_PuXq.js"}