const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SceneTitle-DdCCaaRD.js","../run.js","./SceneGame-BkXgGOom.js"])))=>i.map(i=>d[i]);
import{S as f,P as y,L as t,_ as o,b as u,a as e,A as d,D as r}from"../run.js";import{B as h,g as w,a as p,b as m,i as S}from"./SceneTitle-DdCCaaRD.js";class B extends f{ready;#e=new y;constructor(){super(),this.ready=this.#a()}async end(){t.setCurrentBranch(this.#e.getCurrentBranch())}async#a(){t.getFlags().includes("土砂突破")?h.ffp("assets/sounds/gishiki.mp3"):h.ffp("assets/sounds/魔力の止水域.m4a"),this.#e.before("title",async()=>{this.#e.shaveBranch(1);const{SceneTitle:a}=await o(async()=>{const{SceneTitle:n}=await import("./SceneTitle-DdCCaaRD.js").then(s=>s.S);return{SceneTitle:n}},__vite__mapDeps([0,1]),import.meta.url);return await u.goto(()=>new a),!0}),this.#e.on("first",()=>{t.getFlags().includes("地下")||(t.addFlag("地下"),e.say("大丈夫!?","とりあえず......出口を探そうか。"))}),this.#e.on("地下通路-不",()=>{e.say("(階段から雪崩れ込んだ土砂が道を塞いでいる。)","そんな。","......何か方法を......探そうか。")}),this.#e.before("祭壇",async()=>{if(t.getFlags().includes("土砂突破"))return e.say("(巨石はただそこに佇んでいる。)"),await e.wait(),!0;e.say("(大きな石でできた祭壇。見つめていると不思議な気持ちになる。)","何かをお供えすれば......もしかしたら......。"),await e.wait();const a=["何もしない"],n=t.getItems();return n.includes("ベル")&&n.includes("楽譜")&&n.includes("ガラス瓶")&&a.push("楽譜を供える"),await d.ask(a)==="何もしない"||(h.ffp("assets/sounds/gishiki.mp3",{loopEndS:80}),e.say("(持ち物がひとりでに動き出し、音楽を奏で始める......。)","(近くで大きな音がした。)"),await e.wait(),t.addFlag("土砂突破"),this.#t()),!0}),this.#e.before("蝋燭",async()=>(t.getItems().includes("金属片")?(e.say("(金属片を温めてみると形が変わり始めた。)","(ベルを手に入れた。)"),await e.wait(),t.removeItem("金属片"),t.addItem("ベル"),this.#t()):(e.say("(緑の炎が揺らめいている。)"),await e.wait()),!0)),this.#e.before("外",async()=>await d.ask(["外に出る","出ない"])!=="外に出る"),this.#e.on("外",async()=>{t.getItems().includes("魔女")?e.say("(階段を昇ると青空が見えた。)","うっ、眩しい......。","(鳥の囀りや、虫の声が何処かから聞こえてくる。)","(振り返れば、屋敷はただ、森の奥に沈んでいる。)","(それはもう、魔法のかかっていない、一つの屋敷だった。)"):e.say("(階段を昇ると青空が見えた。)","(閉ざされた屋敷の影を抜け、眩しさに目を細める。)","(外は驚くほど静まり返っていて、全てが嘘だったかのように思えた。)","(手元にはいくつかの物が残っている。)","(選ばれたものと、選ばれなかったもの。)","(振り返れば、屋敷はただ、森の奥に沈んでいる。)","(また、獲物が来るのを待っている。)"),await e.wait(),t.isCleared=!0;const{SceneTitle:a}=await o(async()=>{const{SceneTitle:n}=await import("./SceneTitle-DdCCaaRD.js").then(s=>s.S);return{SceneTitle:n}},__vite__mapDeps([0,1]),import.meta.url);await u.goto(()=>new a,{mode:"fade",msIn:2e3,msOut:2e3})}),this.#e.before("魔女の扉",async()=>{t.getFlags().includes("魔女の部屋")||(e.say("(扉の向こうから何かの気配がする。)","(頭の中ではなく直接声が聞こえた。)","やあ。うまくいったみたいだね。だけど、早く出ていった方がいいよ。","言ったでしょう? この屋敷には物を持ち出せなくする魔法がかかっているんだ。","だから......私はここから動けない。","君までこの屋敷の物になってしまう前に、早く。"),e.wait().then(async()=>{t.getClearedStageId().length===w.length+p.length+m.length-1?(e.say("(得てきたものが、あなたに勇気を与えた。)","(あなたは一歩踏み出し、扉を開けた。)"),await e.wait(),t.addFlag("魔女の部屋"),this.#e.goto("魔女の部屋")):(e.say("(あなたは怖気づいて扉から一歩離れた。)"),await e.wait(),this.#e.back(1))}))}),Object.entries({大穴:["(ここから落ちてきたみたいだ。)"],格子:["(さすがに通れそうにない。)"],扉:["(開かない。)"],地下絵画:["(冒涜的なものを感じる絵。)","宗教は人だけでなく、魔女さえも狂わせたんだ。","昔の話だけどね。"],樽:["(何かの発酵したような臭いがする。)"],箒:["昔は誰でも大空を飛べたんだ。今は......どうなのかな。"]}).forEach(([a,n])=>{this.#e.before(a,async()=>(e.say(...n),await e.wait(),!0))});const i=m;i.forEach(a=>{this.#e.before("get-"+a,async()=>{this.#e.shaveBranch(1);const{SceneGame:n}=await o(async()=>{const{SceneGame:s}=await import("./SceneGame-BkXgGOom.js");return{SceneGame:s}},__vite__mapDeps([2,1,0]),import.meta.url);return await u.goto(()=>new n(a,{from:"adventure"}),{mode:"fade"}),!0})}),i.forEach(a=>{this.#e.on("clear-"+a,async n=>{t.addItem(a),this.#t(),n.back(1,{msIn:0,msOut:0}),e.say(`(${a}を手に入れた。)`),t.setCurrentBranch(this.#e.getCurrentBranch())})}),this.#e.on("clear-魔女",async a=>{t.addItem("魔女"),this.#t(),a.back(1,{msIn:0,msOut:0}),e.say("(魔女を助けた。)"),t.setCurrentBranch(this.#e.getCurrentBranch())});const l=await(await fetch("pages/adventure2.html")).text();await this.#e.load(r.container,l,{history:t.getCurrentBranch()}),this.#t()}#t(){const c=(s,g)=>r.container.querySelector(`[data-link="${s}"]`)?.classList.toggle("hidden",g),i=S;[...r.container.querySelector("#item").children].filter(s=>!s.hasAttribute("data-back")).forEach(s=>s.remove()),t.getItems().forEach(s=>{c(s,!0),r.container.querySelector("#item").innerHTML+=`<button data-link="item-${s}">${s}</button>`,this.#e.before(`item-${s}`,async()=>(e.say(i[s]??"エラー"),!0))}),t.getItems().includes("ベル")&&c("金属片",!0);const a=r.container.querySelector("[data-link=地下通路-不]"),n=r.container.querySelector("[data-link=地下通路-可");t.getFlags().includes("土砂突破")?(a.classList.add("hidden"),n.classList.remove("hidden")):(n.classList.add("hidden"),a.classList.remove("hidden")),this.#e.updateButtons(),r.container.querySelector("#update").onclick=async()=>{t.setCurrentBranch(this.#e.getCurrentBranch()),this.#a()},this.#e.before("save",async()=>(t.setCurrentBranch(this.#e.getCurrentBranch().slice(0,-1)),e.say("(出来事を記憶に留めた。)"),!0))}}export{B as SceneAdventure};
//# sourceMappingURL=SceneAdventure2-CPztAPaT.js.map
