{"version":3,"mappings":"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","names":["LocalStorage","c","chapter","branch","p","items","item","i","id","v","SceneTitle","Scene","#pages","Pages","history","#setup","html","Dom","BGM","modules","__vitePreload","url","SceneAdventure","Scenes","SceneGame","#setupCleared","#setupSetting","#particle","title","size","stages","past","cleared","bgm","se","b","s","SE","d"],"ignoreList":[],"sources":["../../../src/LocalStorage.ts","../../../src/Scenes/SceneTitle.ts"],"sourcesContent":["export class LocalStorage {\r\n    static getChapter(): number {\r\n        const c = localStorage.getItem(\"chapter\")\r\n        return c ? JSON.parse(c) : 0\r\n    }\r\n\r\n    static setChapter(chapter: number) {\r\n        localStorage.setItem(\"chapter\", `${chapter}`)\r\n    }\r\n\r\n    static getCurrentBranch(): string[] {\r\n        const c = localStorage.getItem(\"current-branch\")\r\n        return c ? JSON.parse(c) : []\r\n    }\r\n\r\n    static setCurrentBranch(branch: string[]) {\r\n        localStorage.setItem(\"current-branch\", JSON.stringify(branch))\r\n    }\r\n\r\n    static addBranch(p: string) {\r\n        const c = this.getCurrentBranch()\r\n        c.push(p)\r\n        this.setCurrentBranch(c)\r\n    }\r\n\r\n    static getItems(): Item[] {\r\n        const items = localStorage.getItem(\"items\")\r\n        return items ? JSON.parse(items) : []\r\n    }\r\n\r\n    static setItems(items: Item[]) {\r\n        localStorage.setItem(\"items\", JSON.stringify(items))\r\n    }\r\n\r\n    static removeItem(item: Item) {\r\n        const i = this.getItems()\r\n        this.setItems(i.filter((i) => i !== item))\r\n    }\r\n\r\n    static addItem(item: Item) {\r\n        const items = this.getItems()\r\n        if (!items.includes(item)) {\r\n            items.push(item)\r\n            this.setItems(items)\r\n        }\r\n    }\r\n\r\n    static getFlags(): Flag[] {\r\n        const items = localStorage.getItem(\"flags\")\r\n        return items ? JSON.parse(items) : []\r\n    }\r\n\r\n    static setFlags(items: Flag[]) {\r\n        localStorage.setItem(\"flags\", JSON.stringify(items))\r\n    }\r\n\r\n    static addFlag(item: Flag) {\r\n        const items = this.getFlags()\r\n        items.push(item)\r\n        this.setFlags(items)\r\n    }\r\n\r\n    static addClearedStageId(id: Item) {\r\n        const c = this.getClearedStageId()\r\n        if (!c.includes(id)) {\r\n            c.push(id)\r\n            localStorage.setItem(\"cleared-stages\", JSON.stringify(c))\r\n        }\r\n    }\r\n\r\n    static getClearedStageId(): Item[] {\r\n        const c = localStorage.getItem(\"cleared-stages\")\r\n        return c ? JSON.parse(c) : []\r\n    }\r\n\r\n    static getVolume(): { bgm: number; se: number } {\r\n        const c = localStorage.getItem(\"volume\")\r\n\r\n        if (!c) {\r\n            return {\r\n                bgm: 9,\r\n                se: 9,\r\n            }\r\n        }\r\n\r\n        return JSON.parse(c)\r\n    }\r\n\r\n    static setVolume(v: { bgm: number; se: number }) {\r\n        localStorage.setItem(\"volume\", JSON.stringify(v))\r\n    }\r\n}\r\n\r\nexport type Item =\r\n    | \"1階のカギ\"\r\n    | \"包丁\"\r\n    | \"ライター\"\r\n    | \"水の入ったバケツ\"\r\n    | \"空のバケツ\"\r\n    | \"ぬるついたハンマー\"\r\n    | \"ハンマー\"\r\n    | \"ヘアピン\"\r\n    | \"魔導書\"\r\n    | \"薄い本\"\r\n\r\ntype Flag = \"あらすじ\" | \"met\" | \"key-0\" | \"1st\" | \"ツタを切った\" | \"2階\" | \"寝室開放\" | \"お風呂\" | \"おトイレ\" | \"寝室\"\r\n","import { Dom } from \"../Dom\"\r\nimport { Item, LocalStorage } from \"../LocalStorage\"\r\nimport { SE } from \"../SE\"\r\nimport { BGM } from \"../utils/BGM\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class SceneTitle extends Scene {\r\n    ready: Promise<void>\r\n    #pages = new Pages()\r\n\r\n    constructor(history?: string[]) {\r\n        super()\r\n        this.ready = this.#setup(history)\r\n    }\r\n\r\n    async #setup(history?: string[]) {\r\n        const html = await (await fetch(\"pages/title.html\")).text()\r\n        await this.#pages.load(Dom.container, html, { history })\r\n\r\n        BGM.ffp(\"assets/sounds/title.mp3\")\r\n\r\n        this.#pages.on(\"start\", async () => {\r\n            // @ts-ignore\r\n            const modules = import.meta.glob(\"./SceneAdventure*\")\r\n\r\n            const url = `./SceneAdventure${LocalStorage.getChapter()}.ts`\r\n\r\n            const { SceneAdventure } = await modules[url]()\r\n            await Scenes.goto(() => new SceneAdventure(), { msIn: 400, msOut: 800 })\r\n        })\r\n\r\n        this.#pages.before(\"fullscreen\", async () => {\r\n            if (document.fullscreenElement) {\r\n                document.exitFullscreen()\r\n            } else {\r\n                document.body.requestFullscreen()\r\n            }\r\n            return true\r\n        })\r\n\r\n        const stages: Item[] = [\"1階のカギ\"]\r\n\r\n        stages.forEach((item) => {\r\n            this.#pages.before(item, async () => {\r\n                const { SceneGame } = await import(\"./SceneGame\")\r\n                await Scenes.goto(() => new SceneGame(item, { from: \"title\" }), { mode: \"fade\" })\r\n                return true\r\n            })\r\n        })\r\n\r\n        this.#setupCleared()\r\n        this.#setupSetting()\r\n        this.#particle()\r\n\r\n        this.#pages.updateButtons()\r\n    }\r\n\r\n    #particle() {\r\n        const title = this.#pages.pages.get(\"first\")!\r\n\r\n        for (let i = 0; i < 16; i++) {\r\n            const p = new Image()\r\n            p.src = \"assets/images/particle0.png\"\r\n            p.classList.add(\"particle0\")\r\n\r\n            const size = Math.random() * 16\r\n\r\n            p.style.animationDelay = `${size / 2}s`\r\n            p.style.width = `${size + 16}vh`\r\n            p.style.animationDuration = `${Math.random() * 4 + 8}s`\r\n            p.style.aspectRatio = \"1\"\r\n            p.style.position = \"absolute\"\r\n            p.style.left = `${10 + 80 * (i / 16)}%`\r\n\r\n            title.appendChild(p)\r\n        }\r\n    }\r\n\r\n    #setupCleared() {\r\n        const stages: Item[] = [\r\n            \"1階のカギ\",\r\n            \"包丁\",\r\n            \"ライター\",\r\n            \"空のバケツ\",\r\n            \"ぬるついたハンマー\",\r\n            \"ヘアピン\",\r\n            \"魔導書\",\r\n            \"薄い本\",\r\n        ]\r\n\r\n        const past = this.#pages.pages.get(\"past\")!\r\n\r\n        const cleared = LocalStorage.getClearedStageId()\r\n\r\n        stages.forEach((id) => {\r\n            if (!cleared.includes(id)) return\r\n\r\n            past.innerHTML += `<button data-link=\"stage-${id}\">${id}</button>`\r\n            this.#pages.before(`stage-${id}`, async () => {\r\n                const { SceneGame } = await import(\"./SceneGame\")\r\n                await Scenes.goto(() => new SceneGame(id, { from: \"title\" }), { mode: \"fade\" })\r\n            })\r\n        })\r\n    }\r\n\r\n    #setupSetting() {\r\n        const { bgm, se } = LocalStorage.getVolume()\r\n\r\n        const b = Dom.container.querySelector<HTMLInputElement>(\"#bgm-volume\")!\r\n        const s = Dom.container.querySelector<HTMLInputElement>(\"#se-volume\")!\r\n\r\n        b.value = \"\" + bgm\r\n        s.value = \"\" + se\r\n\r\n        BGM.setVolume(bgm / 9)\r\n        SE.setVolume(se / 9)\r\n\r\n        b.oninput = () => {\r\n            BGM.setVolume(+b.value / 9)\r\n            LocalStorage.setVolume({ bgm: +b.value, se: +s.value })\r\n        }\r\n\r\n        s.oninput = () => {\r\n            SE.setVolume(+s.value / 9)\r\n            LocalStorage.setVolume({ bgm: +b.value, se: +s.value })\r\n        }\r\n\r\n        const d = Dom.container.querySelector<HTMLButtonElement>(\"#delete-data\")!\r\n        d.onclick = () => {\r\n            localStorage.clear()\r\n\r\n            Scenes.goto(() => new SceneTitle())\r\n        }\r\n    }\r\n}\r\n"],"file":"assets/SceneTitle-BxgWCsaY.js"}