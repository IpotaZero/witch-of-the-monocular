{"version":3,"mappings":";8GAQO,MAAMA,UAAkBC,CAAM,CACjC,MAEAC,GAAS,IAAIC,EACbC,GAEAC,GAEA,YAAYC,EAAU,CAAE,KAAAC,GAAyC,CAC7D,QAEA,KAAKF,GAAQE,EAEb,KAAK,MAAQ,KAAKC,GAAOF,CAAE,CAC/B,CAEA,MAAM,KAAqB,CACvB,KAAKF,GAAM,SACf,CAEA,KAAMI,GAAOF,EAAU,CACnB,MAAMG,EAAO,MAAO,MAAM,MAAM,iBAAiB,GAAG,OACpD,MAAM,KAAKP,GAAO,KAAKQ,EAAI,UAAWD,CAAI,EAE1CE,EAAI,IAAI,2BAA4B,CAAE,WAAY,OAAQ,EAE1D,KAAKT,GAAO,GAAG,OAAQ,SAAY,CAC/B,KAAKU,GAAA,CACT,CAAC,EAED,KAAKV,GAAO,GAAG,QAAS,MAAOW,GAAS,CACpCA,EAAK,KAAK,EAAG,CAAE,KAAM,EAAG,MAAO,EAAG,EAClC,KAAKT,GAAM,OACf,CAAC,EAED,KAAKF,GAAO,GAAG,QAAS,MAAOW,GAAS,CACpCC,EAAa,UAAU,SAASR,CAAE,EAAE,EACpC,KAAKM,GAAA,CACT,CAAC,EAED,KAAKG,GAAOT,CAAE,CAClB,CAEA,KAAMM,IAAU,CACZ,GAAI,KAAKP,KAAU,QAAS,CACxB,KAAM,CAAE,WAAAW,CAAA,EAAe,MAAAC,EAAA,2BAAAD,CAAA,OAAM,QAAO,0BAAc,OAAAE,KAAA,qBAAAF,CAAA,2CAElD,MAAMG,EAAO,KAAK,IAAM,IAAIH,EAAW,CAAC,QAAS,MAAM,CAAC,CAAC,EAEzD,MACJ,CAGA,MAAMI,EAAU,0CAAAH,EAAA,iHAAAA,EAAA,wFAEVI,EAAM,mBAAmBP,EAAa,YAAY,MAElD,CAAE,eAAAQ,CAAA,EAAmB,MAAMF,EAAQC,CAAG,IAC5C,MAAMF,EAAO,KAAK,IAAM,IAAIG,CAAgB,CAChD,CAEA,KAAMP,GAAOT,EAAU,CAEnB,MAAMc,EAAU,6CAAAH,EAAA,iHAAAA,EAAA,6NAAAA,EAAA,yGAAAA,EAAA,0GAAAA,EAAA,0SAEVI,EAAM,kBAAkBf,CAAE,MAE1B,CAAE,MAAAiB,CAAA,EAAU,MAAMH,EAAQC,CAAG,IACnC,KAAKjB,GAAQ,IAAImB,EAAMb,EAAI,UAAU,cAAc,gBAAgB,CAAC,EAEpE,KAAKN,GAAM,QAAU,IAAM,CACvBM,EAAI,UAAU,cAAc,QAAQ,GAAG,UAAU,OAAO,QAAQ,EAChEI,EAAa,kBAAkBR,CAAE,CACrC,EAEAI,EAAI,UAAU,cAAc,WAAW,EAAG,YAAc,GAAGJ,CAAE,EACjE,CACJ","names":["SceneGame","Scene","#pages","Pages","#game","#from","id","from","#setup","html","Dom","BGM","#return","page","LocalStorage","#start","SceneTitle","__vitePreload","n","Scenes","modules","url","SceneAdventure","Stage"],"ignoreList":[],"sources":["../../../src/Scenes/SceneGame.ts"],"sourcesContent":["import { Dom } from \"../Dom\"\r\nimport { Game } from \"../Games/Game\"\r\nimport { Item, LocalStorage } from \"../LocalStorage\"\r\nimport { BGM } from \"../utils/BGM\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class SceneGame extends Scene {\r\n    ready: Promise<void>\r\n\r\n    #pages = new Pages()\r\n    #game!: Game\r\n\r\n    #from: \"title\" | \"adventure\"\r\n\r\n    constructor(id: Item, { from }: { from: \"title\" | \"adventure\" }) {\r\n        super()\r\n\r\n        this.#from = from\r\n\r\n        this.ready = this.#setup(id)\r\n    }\r\n\r\n    async end(): Promise<void> {\r\n        this.#game.destroy()\r\n    }\r\n\r\n    async #setup(id: Item) {\r\n        const html = await (await fetch(\"pages/game.html\")).text()\r\n        await this.#pages.load(Dom.container, html)\r\n\r\n        BGM.ffp(\"assets/sounds/puzzle.mp3\", { loopStartS: 17.297 })\r\n\r\n        this.#pages.on(\"back\", async () => {\r\n            this.#return()\r\n        })\r\n\r\n        this.#pages.on(\"retry\", async (page) => {\r\n            page.back(1, { msIn: 0, msOut: 0 })\r\n            this.#game.reset()\r\n        })\r\n\r\n        this.#pages.on(\"clear\", async (page) => {\r\n            LocalStorage.addBranch(`clear-${id}`)\r\n            this.#return()\r\n        })\r\n\r\n        this.#start(id)\r\n    }\r\n\r\n    async #return() {\r\n        if (this.#from === \"title\") {\r\n            const { SceneTitle } = await import(\"./SceneTitle\")\r\n\r\n            await Scenes.goto(() => new SceneTitle([\"first\", \"past\"]))\r\n\r\n            return\r\n        }\r\n\r\n        // @ts-ignore\r\n        const modules = import.meta.glob(\"./SceneAdventure*\")\r\n\r\n        const url = `./SceneAdventure${LocalStorage.getChapter()}.ts`\r\n\r\n        const { SceneAdventure } = await modules[url]()\r\n        await Scenes.goto(() => new SceneAdventure())\r\n    }\r\n\r\n    async #start(id: Item) {\r\n        // @ts-ignore\r\n        const modules = import.meta.glob(\"../Stages/*\")\r\n\r\n        const url = `../Stages/Stage${id}.ts`\r\n\r\n        const { Stage } = await modules[url]()\r\n        this.#game = new Stage(Dom.container.querySelector(\"#first #center\"))\r\n\r\n        this.#game.onClear = () => {\r\n            Dom.container.querySelector(\"#clear\")?.classList.remove(\"hidden\")\r\n            LocalStorage.addClearedStageId(id)\r\n        }\r\n\r\n        Dom.container.querySelector(\"#stage-id\")!.textContent = `${id}`\r\n    }\r\n}\r\n"],"file":"assets/SceneGame-Blr9UHqg.js"}