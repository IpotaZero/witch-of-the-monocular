{"version":3,"mappings":"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","names":["Dom","LocalStorage","data","chapter","branch","p","c","items","item","i","id","v","isCleared","Awaits","container","ms","resolve","abort","e","fn","Pages","RegExpDict","#handlers","#leftHandlers","#beforeHandlers","#container","#currentBranch","#currentPageId","html","history","first","page","num","selector","handler","form","input","b","button","msIn","back","backDepth","msOut","#back","option","#runBefore","#disableButtons","#runLeft","from","to","#fadeIn","#runOn","fromLayerNum","toLayerNum","#fade","before","#ableButtons","#dict","dict","key","reg","value","Scene","Scenes","#currentScene","firstScene","newScene","showLoading","#showLoading","hideLoading","#hideLoading","mode","#fadeOut","done","showed","ScenePretitle","#pages","#setup","#start","SceneTitle","n","Sound","#audio","path","volume","SE","se","Serif","#textArea","#texts","#resolve","#say","text","Ask","options","buttons"],"ignoreList":[],"sources":["../../src/Dom.ts","../../src/LocalStorage.ts","../../src/utils/Awaits.ts","../../src/utils/Pages.ts","../../src/Scenes/Scene.ts","../../src/Scenes/Scenes.ts","../../src/Scenes/ScenePretitle.ts","../../src/SE.ts","../../src/utils/Serif.ts","../../src/run.ts"],"sourcesContent":["export class Dom {\r\n    static container: HTMLElement\r\n\r\n    static init() {\r\n        this.container = document.getElementById(\"container\")!\r\n    }\r\n}\r\n","import { Item } from \"./Item\"\r\n\r\nexport class LocalStorage {\r\n    private static readonly DATA_KEY = \"wotm-data\"\r\n\r\n    private static getData(): Record<string, any> {\r\n        const data = localStorage.getItem(this.DATA_KEY)\r\n        return data ? JSON.parse(data) : {}\r\n    }\r\n\r\n    private static setData(data: Record<string, any>) {\r\n        localStorage.setItem(this.DATA_KEY, JSON.stringify(data))\r\n    }\r\n\r\n    static getChapter(): number {\r\n        const data = this.getData()\r\n        return data.chapter ?? 0\r\n    }\r\n\r\n    static setChapter(chapter: number) {\r\n        const data = this.getData()\r\n        data.chapter = chapter\r\n        this.setData(data)\r\n    }\r\n\r\n    static getCurrentBranch(): string[] {\r\n        const data = this.getData()\r\n        return data.currentBranch ?? []\r\n    }\r\n\r\n    static setCurrentBranch(branch: string[]) {\r\n        const data = this.getData()\r\n        data.currentBranch = branch\r\n        this.setData(data)\r\n    }\r\n\r\n    static addBranch(p: string) {\r\n        const c = this.getCurrentBranch()\r\n        c.push(p)\r\n        this.setCurrentBranch(c)\r\n    }\r\n\r\n    static getItems(): Item[] {\r\n        const data = this.getData()\r\n        return data.items ?? []\r\n    }\r\n\r\n    static setItems(items: Item[]) {\r\n        const data = this.getData()\r\n        data.items = items\r\n        this.setData(data)\r\n    }\r\n\r\n    static removeItem(item: Item) {\r\n        const i = this.getItems()\r\n        this.setItems(i.filter((i) => i !== item))\r\n    }\r\n\r\n    static addItem(item: Item) {\r\n        const items = this.getItems()\r\n        if (!items.includes(item)) {\r\n            items.push(item)\r\n            this.setItems(items)\r\n        }\r\n    }\r\n\r\n    static getFlags(): Flag[] {\r\n        const data = this.getData()\r\n        return data.flags ?? []\r\n    }\r\n\r\n    static setFlags(items: Flag[]) {\r\n        const data = this.getData()\r\n        data.flags = items\r\n        this.setData(data)\r\n    }\r\n\r\n    static addFlag(item: Flag) {\r\n        const items = this.getFlags()\r\n        items.push(item)\r\n        this.setFlags(items)\r\n    }\r\n\r\n    static addClearedStageId(id: Item) {\r\n        const c = this.getClearedStageId()\r\n        if (!c.includes(id)) {\r\n            c.push(id)\r\n            const data = this.getData()\r\n            data.clearedStages = c\r\n            this.setData(data)\r\n        }\r\n    }\r\n\r\n    static getClearedStageId(): Item[] {\r\n        const data = this.getData()\r\n        return data.clearedStages ?? []\r\n    }\r\n\r\n    static getVolume(): { bgm: number; se: number } {\r\n        const data = this.getData()\r\n        return data.volume ?? { bgm: 9, se: 9 }\r\n    }\r\n\r\n    static setVolume(v: { bgm: number; se: number }) {\r\n        const data = this.getData()\r\n        data.volume = v\r\n        this.setData(data)\r\n    }\r\n\r\n    static set isCleared(isCleared: boolean) {\r\n        const data = this.getData()\r\n        data.isCleared = isCleared\r\n        this.setData(data)\r\n    }\r\n\r\n    static get isCleared() {\r\n        const data = this.getData()\r\n        return data.isCleared ?? false\r\n    }\r\n\r\n    static clear() {\r\n        localStorage.removeItem(this.DATA_KEY)\r\n    }\r\n}\r\n\r\ntype Flag =\r\n    | \"あらすじ\"\r\n    | \"met\"\r\n    | \"key-0\"\r\n    | \"1st\"\r\n    | \"ツタを切った\"\r\n    | \"2階\"\r\n    | \"寝室開放\"\r\n    | \"お風呂\"\r\n    | \"おトイレ\"\r\n    | \"寝室\"\r\n    | \"地下\"\r\n    | \"土砂突破\"\r\n    | \"魔女の部屋\"\r\n","export class Awaits {\r\n    static async fade(container: HTMLElement, ms: number = 200) {\r\n        await this.fadeOut(container, ms)\r\n        this.fadeIn(container, ms)\r\n    }\r\n\r\n    static async fadeOut(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n        ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.pointerEvents = \"none\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n    }\r\n\r\n    static async fadeIn(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n        ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.pointerEvents = \"\"\r\n            ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"\"))\r\n        })\r\n\r\n        await this.sleep(ms)\r\n    }\r\n\r\n    static sleep(ms: number) {\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(resolve, ms)\r\n        })\r\n    }\r\n\r\n    static ok() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                        abort.abort()\r\n                        resolve()\r\n                    }\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static key() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static frame(fn = () => {}) {\r\n        return new Promise<void>((resolve) =>\r\n            requestAnimationFrame(() => {\r\n                fn()\r\n                resolve()\r\n            }),\r\n        )\r\n    }\r\n\r\n    static async enter(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"0\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async enterReverse(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"0\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async exit(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"3\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async exitReverse(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"3\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n}\r\n","import { Awaits } from \"./Awaits\"\r\n\r\ntype Handler = (pages: Pages) => void\r\ntype BeforeHandler = (pages: Pages) => Promise<boolean | void>\r\ntype LeftHandler = (pages: Pages) => void | Promise<void>\r\n\r\ntype FadeOption = Partial<{ msIn: number; msOut: number; back: boolean }>\r\n\r\nexport class Pages {\r\n    defaultMSIn = 700\r\n    defaultMSOut = 700\r\n\r\n    readonly pages = new RegExpDict<HTMLElement>({})\r\n\r\n    readonly #handlers = new RegExpDict<Handler>({})\r\n    readonly #leftHandlers = new RegExpDict<LeftHandler>({})\r\n    readonly #beforeHandlers = new RegExpDict<BeforeHandler>({})\r\n\r\n    #container!: HTMLElement\r\n    #currentBranch: string[] = []\r\n\r\n    #currentPageId = \"絶対に存在しないページID\"\r\n\r\n    async load(container: HTMLElement, html: string, { history }: { history?: string[] } = {}) {\r\n        this.#container = container\r\n        this.#container.innerHTML = html\r\n\r\n        const first = history && history.length ? history.at(-1)! : \"first\"\r\n        this.#currentBranch = history && history.length ? history.slice(0, -1) : []\r\n\r\n        Array.from(container.querySelectorAll<HTMLElement>(\".page\")).forEach((page) => {\r\n            this.pages.add(page.id, page)\r\n\r\n            if (page.id !== first) page.classList.add(\"hidden\")\r\n        })\r\n\r\n        await this.goto(first, { msIn: 0, msOut: 0 })\r\n        this.updateButtons()\r\n    }\r\n\r\n    shaveBranch(num: number) {\r\n        this.#currentBranch = this.#currentBranch.slice(0, -num)\r\n    }\r\n\r\n    getCurrentBranch() {\r\n        return [...this.#currentBranch]\r\n    }\r\n\r\n    on(selector: string, handler: Handler) {\r\n        this.#handlers.add(selector, handler)\r\n    }\r\n\r\n    onLeft(selector: string, handler: LeftHandler) {\r\n        this.#leftHandlers.add(selector, handler)\r\n    }\r\n\r\n    before(selector: string, handler: BeforeHandler) {\r\n        this.#beforeHandlers.add(selector, handler)\r\n    }\r\n\r\n    onSubmit(selector: string, handler: (value: string) => void) {\r\n        const page = this.pages.get(selector)\r\n\r\n        if (!page) throw new Error(\"そんなページはない\")\r\n\r\n        const form = page.querySelector(\"form\")\r\n        const input = page.querySelector(\"input\")\r\n\r\n        if (!form || !input) throw new Error(\"そんなformはない\")\r\n\r\n        form.onsubmit = (e) => {\r\n            e.preventDefault()\r\n            handler(input.value)\r\n        }\r\n    }\r\n\r\n    updateButtons() {\r\n        Array.from(this.#container.querySelectorAll(\"button\"))\r\n            .filter((b) => !b.classList.contains(\"non-page\"))\r\n            .forEach((button, i) => {\r\n                let msIn: number\r\n\r\n                if (button.hasAttribute(\"data-ms-in\")) {\r\n                    msIn = Number(button.getAttribute(\"data-ms-in\"))\r\n                }\r\n\r\n                button.onclick = () => {\r\n                    this.goto(button.dataset[\"link\"]!, {\r\n                        msIn,\r\n                        back: button.classList.contains(\"back\"),\r\n                    })\r\n                }\r\n\r\n                const back = button.getAttribute(\"data-back\")\r\n\r\n                if (back) {\r\n                    button.onclick = () => {\r\n                        this.back(Number(back), { msIn })\r\n                    }\r\n                }\r\n            })\r\n    }\r\n\r\n    async back(backDepth: number, { msIn, msOut }: FadeOption = {}) {\r\n        for (let i = 0; i < backDepth; i++) {\r\n            this.#back({\r\n                msIn: msIn,\r\n                msOut: msOut,\r\n                back: true,\r\n            })\r\n        }\r\n    }\r\n\r\n    #back(option: FadeOption) {\r\n        if (this.#currentBranch.length <= 0) return\r\n        this.#currentBranch.pop()\r\n        this.goto(this.#currentBranch.pop()!, option)\r\n    }\r\n\r\n    async goto(id: string, { msIn = this.defaultMSIn, msOut = this.defaultMSOut, back = false }: FadeOption = {}) {\r\n        if (await this.#runBefore(id)) return\r\n        this.#disableButtons()\r\n        await this.#runLeft(this.#currentPageId)\r\n\r\n        const from = this.pages.get(this.#currentPageId)\r\n        const to = this.pages.get(id)\r\n\r\n        this.#currentPageId = id\r\n        this.#currentBranch.push(id)\r\n\r\n        await this.#fadeIn(msIn, from, to, back)\r\n\r\n        this.#runOn(this.#currentPageId)\r\n    }\r\n\r\n    async #fadeIn(msIn: number, from: HTMLElement | undefined, to: HTMLElement | undefined, back: boolean) {\r\n        to?.classList.remove(\"hidden\")\r\n\r\n        if (msIn > 0) {\r\n            const fromLayerNum = Number(from?.getAttribute(\"data-layer\")) || 0\r\n            const toLayerNum = Number(to?.getAttribute(\"data-layer\")) || 0\r\n\r\n            if (fromLayerNum <= toLayerNum) {\r\n                this.#fade(to, back, msIn, true)\r\n            }\r\n\r\n            if (fromLayerNum >= toLayerNum) {\r\n                this.#fade(from, back, msIn, false)\r\n            }\r\n\r\n            await Awaits.sleep(msIn)\r\n\r\n            if (fromLayerNum >= toLayerNum) {\r\n                from?.classList.add(\"hidden\")\r\n            }\r\n        }\r\n    }\r\n\r\n    #fade(page: HTMLElement | undefined, back: boolean, msIn: number, to: boolean) {\r\n        if (to) {\r\n            if (back) {\r\n                page && Awaits.exitReverse(page, msIn)\r\n            } else {\r\n                page && Awaits.enter(page, msIn)\r\n            }\r\n        } else {\r\n            if (back) {\r\n                page && Awaits.enterReverse(page, msIn)\r\n            } else {\r\n                page && Awaits.exit(page, msIn)\r\n            }\r\n        }\r\n    }\r\n\r\n    async #runBefore(id: string) {\r\n        const before = this.#beforeHandlers\r\n            .getAll(id)\r\n            .map((handler) => handler(this))\r\n            .toArray()\r\n\r\n        const p = await Promise.all(before)\r\n\r\n        return p.some(Boolean)\r\n    }\r\n\r\n    #runLeft(id: string) {\r\n        return Promise.all(this.#leftHandlers.getAll(id).map((handler) => handler(this)))\r\n    }\r\n\r\n    #runOn(id: string) {\r\n        requestAnimationFrame(() => {\r\n            this.#handlers.getAll(id).forEach((handler) => handler(this))\r\n            this.#ableButtons()\r\n        })\r\n    }\r\n\r\n    #disableButtons() {\r\n        this.#container.style.pointerEvents = \"none\"\r\n\r\n        this.pages.getValues().forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        this.pages.getValues().forEach((page) => page.querySelectorAll(\"button\").forEach((b) => (b.disabled = true)))\r\n    }\r\n\r\n    #ableButtons() {\r\n        this.pages\r\n            .getValues()\r\n            .filter((page) => !page.classList.contains(\"hidden\"))\r\n            .forEach((page) => page.querySelectorAll(\"button\").forEach((b) => (b.disabled = false)))\r\n\r\n        this.#container.style.pointerEvents = \"\"\r\n        this.pages.getValues().forEach((p) => (p.style.pointerEvents = \"\"))\r\n    }\r\n}\r\n\r\nexport class RegExpDict<T> {\r\n    readonly #dict: Record<string, T>\r\n\r\n    constructor(dict: Record<string, T>) {\r\n        this.#dict = dict\r\n    }\r\n\r\n    get(key: string): T | undefined {\r\n        for (const [reg, value] of Object.entries(this.#dict)) {\r\n            if (new RegExp(`^${reg}$`).test(key)) {\r\n                return value\r\n            }\r\n        }\r\n    }\r\n\r\n    *getAll(key: string): Generator<T, undefined, unknown> {\r\n        for (const [reg, value] of Object.entries(this.#dict)) {\r\n            if (new RegExp(`^${reg}$`).test(key)) {\r\n                yield value\r\n            }\r\n        }\r\n    }\r\n\r\n    getKeys(): string[] {\r\n        return Object.keys(this.#dict)\r\n    }\r\n\r\n    getValues(): T[] {\r\n        return Object.values(this.#dict)\r\n    }\r\n\r\n    add(reg: string, value: T) {\r\n        this.#dict[reg] = value\r\n    }\r\n}\r\n","export abstract class Scene {\r\n    abstract readonly ready: Promise<void>\r\n    async end() {}\r\n}\r\n","import { Awaits } from \"../utils/Awaits.js\"\r\nimport { Scene } from \"./Scene.js\"\r\n\r\nexport class Scenes {\r\n    static #currentScene: Scene\r\n\r\n    static init(firstScene: Scene) {\r\n        this.#currentScene = firstScene\r\n    }\r\n\r\n    static async goto(\r\n        newScene: () => Scene,\r\n        {\r\n            showLoading = this.#showLoading,\r\n            hideLoading = this.#hideLoading,\r\n            msIn = 800,\r\n            msOut = 800,\r\n            mode = \"scale\",\r\n        }: {\r\n            showLoading?: () => void\r\n            hideLoading?: () => void\r\n            msIn?: number\r\n            msOut?: number\r\n            mode?: \"scale\" | \"fade\"\r\n        } = {},\r\n    ) {\r\n        const container = document.getElementById(\"container\")!\r\n\r\n        await this.#fadeOut(container, msIn, mode)\r\n        await this.#currentScene.end()\r\n\r\n        let done = false\r\n        let showed = false\r\n\r\n        // 1秒タイマーを並行実行\r\n        Awaits.sleep(1000).then(() => {\r\n            if (!done) {\r\n                showLoading() // ローディング画面表示\r\n                showed = true\r\n            }\r\n        })\r\n\r\n        this.#currentScene = newScene()\r\n        await this.#currentScene.ready // メイン処理実行\r\n        done = true // 1秒以内に終わればローディングは表示されない\r\n\r\n        if (showed) {\r\n            hideLoading()\r\n        }\r\n\r\n        await this.#fadeIn(container, msOut, mode)\r\n    }\r\n\r\n    static async #fadeOut(container: HTMLElement, msIn: number, mode: \"scale\" | \"fade\") {\r\n        if (msIn > 0) {\r\n            if (mode === \"scale\") {\r\n                await Awaits.exit(container, msIn)\r\n            } else if (mode === \"fade\") {\r\n                await Awaits.fadeOut(container, msIn)\r\n            }\r\n        }\r\n    }\r\n\r\n    static async #fadeIn(container: HTMLElement, msOut: number, mode: \"scale\" | \"fade\") {\r\n        if (msOut > 0) {\r\n            if (mode === \"scale\") {\r\n                await Awaits.enter(container, msOut)\r\n            } else if (mode === \"fade\") {\r\n                await Awaits.fadeIn(container, msOut)\r\n            }\r\n        }\r\n    }\r\n\r\n    static #showLoading() {\r\n        const p = document.createElement(\"p\")\r\n        p.textContent = \"Loading...\"\r\n        p.classList.add(\"loading\")\r\n        document.body.appendChild(p)\r\n    }\r\n\r\n    static #hideLoading() {\r\n        document.querySelectorAll(\".loading\").forEach((e) => e.remove())\r\n    }\r\n}\r\n","import { Dom } from \"../Dom\"\r\nimport { Awaits } from \"../utils/Awaits\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class ScenePretitle extends Scene {\r\n    ready: Promise<void>\r\n\r\n    #pages = new Pages()\r\n\r\n    constructor() {\r\n        super()\r\n\r\n        this.ready = this.#setup()\r\n    }\r\n\r\n    async #setup() {\r\n        const html = await (await fetch(\"pages/pretitle.html\")).text()\r\n        await this.#pages.load(Dom.container, html)\r\n\r\n        this.#start()\r\n    }\r\n\r\n    async #start() {\r\n        await Awaits.ok()\r\n\r\n        const { SceneTitle } = await import(\"./SceneTitle\")\r\n        await Scenes.goto(() => new SceneTitle(), { mode: \"fade\", msOut: 1000 })\r\n    }\r\n}\r\n","export class Sound {\r\n    #audio: HTMLAudioElement\r\n\r\n    constructor(path: string, volume: number = 0.5) {\r\n        this.#audio = new Audio(path)\r\n        this.#audio.volume = volume\r\n    }\r\n\r\n    get duration() {\r\n        return this.#audio.duration\r\n    }\r\n\r\n    play() {\r\n        this.#audio.currentTime = 0\r\n        this.#audio.play()\r\n    }\r\n\r\n    setVolume(volume: number) {\r\n        this.#audio.volume = volume\r\n    }\r\n}\r\n\r\nexport class SE {\r\n    static voice = new Sound(\"assets/sounds/voice.wav\")\r\n    static what = new Sound(\"assets/sounds/what.wav\")\r\n    static surprised = new Sound(\"assets/sounds/surprised.wav\")\r\n    static strong = new Sound(\"assets/sounds/strong.wav\")\r\n    static say = new Sound(\"assets/sounds/say.mp3\")\r\n\r\n    static clear = new Sound(\"assets/sounds/clear.mp3\", 1)\r\n\r\n    static setVolume(volume: number) {\r\n        Object.values(this).forEach((se) => {\r\n            se.setVolume(volume)\r\n        })\r\n    }\r\n}\r\n","import { SE } from \"../SE\"\r\n\r\nexport class Serif {\r\n    static #container: HTMLElement\r\n    static #textArea: HTMLElement\r\n\r\n    static #texts: string[] = []\r\n\r\n    static #resolve: () => void = () => {}\r\n\r\n    static wait() {\r\n        return new Promise<void>((resolve) => {\r\n            this.#resolve = resolve\r\n        })\r\n    }\r\n\r\n    static init() {\r\n        this.#container = document.createElement(\"div\")\r\n        this.#container.id = \"serif-container\"\r\n        this.#container.classList.add(\"hidden\")\r\n\r\n        this.#textArea = document.createElement(\"div\")\r\n        this.#textArea.id = \"serif\"\r\n        this.#textArea.classList.add(\"fade-in\", \"hidden\")\r\n\r\n        this.#container.onclick = () => {\r\n            this.#say()\r\n        }\r\n\r\n        window.addEventListener(\"keydown\", (e) => {\r\n            if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                this.#say()\r\n            }\r\n        })\r\n\r\n        this.#container.appendChild(this.#textArea)\r\n        document.body.appendChild(this.#container)\r\n    }\r\n\r\n    static hide() {\r\n        this.#container.classList.add(\"hidden\")\r\n    }\r\n\r\n    static show() {\r\n        this.#container.classList.remove(\"hidden\")\r\n        this.#textArea.classList.add(\"hidden\")\r\n    }\r\n\r\n    static say(...text: string[]) {\r\n        this.#texts = text\r\n        this.#say()\r\n        this.show()\r\n    }\r\n\r\n    static #say() {\r\n        if (this.#texts.length === 0) {\r\n            this.#container.classList.add(\"hidden\")\r\n            this.#resolve()\r\n        } else {\r\n            this.#textArea.classList.remove(\"fade-in\")\r\n\r\n            const t = this.#texts.shift() + \"\"\r\n\r\n            if (!t.endsWith(\")\")) {\r\n                this.#textArea.innerHTML = `<img src=\"assets/images/icon.png\" align=\"top\" />`\r\n            } else {\r\n                this.#textArea.innerHTML = \"\"\r\n                SE.say.play()\r\n            }\r\n\r\n            if (t.endsWith(\")\")) {\r\n            } else if (t.endsWith(\"!\")) {\r\n                SE.strong.play()\r\n            } else if (t.endsWith(\"!?\")) {\r\n                SE.surprised.play()\r\n            } else if (t.endsWith(\"?\")) {\r\n                SE.what.play()\r\n            } else {\r\n                SE.voice.play()\r\n            }\r\n\r\n            requestAnimationFrame(() => {\r\n                this.#textArea.innerHTML += `<div class=\"text-area text-end\">${t}</div>`\r\n                this.#textArea.classList.add(\"fade-in\")\r\n                this.#textArea.classList.remove(\"hidden\")\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nexport class Ask {\r\n    static #container: HTMLElement\r\n    static #textArea: HTMLElement\r\n\r\n    static init() {\r\n        this.#container = document.createElement(\"div\")\r\n        this.#container.id = \"serif-container\"\r\n        this.#container.classList.add(\"hidden\")\r\n\r\n        this.#textArea = document.createElement(\"div\")\r\n        this.#textArea.id = \"ask\"\r\n        this.#textArea.classList.add(\"fade-in\")\r\n\r\n        this.#container.appendChild(this.#textArea)\r\n        document.body.appendChild(this.#container)\r\n    }\r\n\r\n    static hide() {\r\n        this.#container.classList.add(\"hidden\")\r\n    }\r\n\r\n    static show() {\r\n        this.#container.classList.remove(\"hidden\")\r\n    }\r\n\r\n    static ask(options: readonly string[]) {\r\n        this.show()\r\n\r\n        this.#textArea.innerHTML = \"\"\r\n\r\n        const buttons = options.map((text) => {\r\n            const b = document.createElement(\"button\")\r\n            b.textContent = text\r\n            b.classList.add(\"question-button\")\r\n            this.#textArea.appendChild(b)\r\n\r\n            return b\r\n        })\r\n\r\n        return new Promise<(typeof options)[number]>((resolve) => {\r\n            buttons.forEach((b, i) => {\r\n                b.onclick = () => {\r\n                    resolve(options[i])\r\n                    this.hide()\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n","import { Dom } from \"./Dom\"\r\nimport { LocalStorage } from \"./LocalStorage\"\r\nimport { ScenePretitle } from \"./Scenes/ScenePretitle\"\r\nimport { Scenes } from \"./Scenes/Scenes\"\r\nimport { Ask, Serif } from \"./utils/Serif\"\r\n\r\nAsk.init()\r\nSerif.init()\r\nDom.init()\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    const params = new URLSearchParams(window.location.search)\r\n    if (params.get(\"delete\") === \"true\") {\r\n        LocalStorage.clear()\r\n    }\r\n    Scenes.init(new ScenePretitle())\r\n})\r\n\r\nwindow.addEventListener(\"contextmenu\", (e) => {\r\n    e.preventDefault()\r\n})\r\n"],"file":"run.js"}