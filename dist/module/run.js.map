{"version":3,"mappings":"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","names":["Dom","Awaits","container","ms","p","resolve","abort","e","fn","Pages","RegExpDict","#handlers","#leftHandlers","#beforeHandlers","#container","#currentBranch","#currentPageId","html","history","first","page","num","selector","handler","form","input","b","button","i","msIn","back","backDepth","msOut","#back","option","id","#runBefore","#disableButtons","#runLeft","from","to","#fadeIn","#runOn","fromLayerNum","toLayerNum","#fade","before","#ableButtons","#dict","dict","key","reg","value","Scene","Scenes","#currentScene","firstScene","newScene","showLoading","#showLoading","hideLoading","#hideLoading","mode","#fadeOut","done","showed","ScenePretitle","#pages","#setup","#start","SceneTitle","n","BGM","#context","#wholeGain","#volume","#initialized","#currentBGM","#path","#gain","#ready","#source","#isStarted","path","options","#localFetch","arrayBuffer","buffer","#localFadeOut","durationMS","#fetch","#play","when","volume","Sound","#audio","SE","se","Serif","#textArea","#texts","#resolve","#say","text"],"ignoreList":[],"sources":["../../src/Dom.ts","../../src/utils/Awaits.ts","../../src/utils/Pages.ts","../../src/Scenes/Scene.ts","../../src/Scenes/Scenes.ts","../../src/Scenes/ScenePretitle.ts","../../src/utils/BGM.ts","../../src/SE.ts","../../src/utils/Serif.ts","../../src/run.ts"],"sourcesContent":["export class Dom {\r\n    static container: HTMLElement\r\n\r\n    static init() {\r\n        this.container = document.getElementById(\"container\")!\r\n    }\r\n}\r\n","export class Awaits {\r\n    static async fade(container: HTMLElement, ms: number = 200) {\r\n        await this.fadeOut(container, ms)\r\n        this.fadeIn(container, ms)\r\n    }\r\n\r\n    static async fadeOut(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n        ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.pointerEvents = \"none\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n    }\r\n\r\n    static async fadeIn(container: HTMLElement, ms: number = 200) {\r\n        container.style.transition = \"opacity 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n        ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.pointerEvents = \"\"\r\n            ;([...container.children] as HTMLElement[]).forEach((p) => (p.style.pointerEvents = \"\"))\r\n        })\r\n\r\n        await this.sleep(ms)\r\n    }\r\n\r\n    static sleep(ms: number) {\r\n        return new Promise<void>((resolve) => {\r\n            setTimeout(resolve, ms)\r\n        })\r\n    }\r\n\r\n    static ok() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                        abort.abort()\r\n                        resolve()\r\n                    }\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static key() {\r\n        const abort = new AbortController()\r\n\r\n        return new Promise<void>((resolve) => {\r\n            document.addEventListener(\r\n                \"click\",\r\n                () => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n\r\n            document.addEventListener(\r\n                \"keydown\",\r\n                (e) => {\r\n                    abort.abort()\r\n                    resolve()\r\n                },\r\n                { signal: abort.signal },\r\n            )\r\n        })\r\n    }\r\n\r\n    static frame(fn = () => {}) {\r\n        return new Promise<void>((resolve) =>\r\n            requestAnimationFrame(() => {\r\n                fn()\r\n                resolve()\r\n            }),\r\n        )\r\n    }\r\n\r\n    static async enter(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"0\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async enterReverse(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"0\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async exit(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"3\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n\r\n    static async exitReverse(container: HTMLElement, ms: number) {\r\n        container.style.transition = \"opacity 0s, scale 0s\"\r\n        container.style.pointerEvents = \"none\"\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"0\"\r\n            container.style.scale = \"3\"\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.transition = `opacity ${ms}ms, scale ${ms}ms`\r\n        })\r\n\r\n        await this.frame(() => {\r\n            container.style.opacity = \"1\"\r\n            container.style.scale = \"1\"\r\n            container.style.pointerEvents = \"\"\r\n        })\r\n\r\n        await this.sleep(ms)\r\n\r\n        this.frame()\r\n\r\n        container.style.pointerEvents = \"all\"\r\n    }\r\n}\r\n","import { Awaits } from \"./Awaits\"\r\n\r\ntype Handler = (pages: Pages) => void\r\ntype BeforeHandler = (pages: Pages) => Promise<boolean | void>\r\n\r\ntype FadeOption = Partial<{ msIn: number; msOut: number; back: boolean }>\r\n\r\nexport class Pages {\r\n    defaultMSIn = 700\r\n    defaultMSOut = 700\r\n\r\n    readonly pages = new RegExpDict<HTMLElement>({})\r\n\r\n    readonly #handlers = new RegExpDict<Handler>({})\r\n    readonly #leftHandlers = new RegExpDict<Handler>({})\r\n    readonly #beforeHandlers = new RegExpDict<BeforeHandler>({})\r\n\r\n    #container!: HTMLElement\r\n    #currentBranch: string[] = []\r\n\r\n    #currentPageId = \"絶対に存在しないページID\"\r\n\r\n    async load(container: HTMLElement, html: string, { history }: { history?: string[] } = {}) {\r\n        this.#container = container\r\n        this.#container.innerHTML = html\r\n\r\n        const first = history && history.length ? history.at(-1)! : \"first\"\r\n        this.#currentBranch = history && history.length ? history.slice(0, -1) : []\r\n\r\n        Array.from(container.querySelectorAll<HTMLElement>(\".page\")).forEach((page) => {\r\n            this.pages.add(page.id, page)\r\n\r\n            if (page.id !== first) page.classList.add(\"hidden\")\r\n        })\r\n\r\n        await this.goto(first, { msIn: 0, msOut: 0 })\r\n        this.updateButtons()\r\n    }\r\n\r\n    shaveBranch(num: number) {\r\n        this.#currentBranch = this.#currentBranch.slice(0, -num)\r\n    }\r\n\r\n    getCurrentBranch() {\r\n        return [...this.#currentBranch]\r\n    }\r\n\r\n    on(selector: string, handler: Handler) {\r\n        this.#handlers.add(selector, handler)\r\n    }\r\n\r\n    onLeft(selector: string, handler: Handler) {\r\n        this.#leftHandlers.add(selector, handler)\r\n    }\r\n\r\n    before(selector: string, handler: BeforeHandler) {\r\n        this.#beforeHandlers.add(selector, handler)\r\n    }\r\n\r\n    onSubmit(selector: string, handler: (value: string) => void) {\r\n        const page = this.pages.get(selector)\r\n\r\n        if (!page) throw new Error(\"そんなページはない\")\r\n\r\n        const form = page.querySelector(\"form\")\r\n        const input = page.querySelector(\"input\")\r\n\r\n        if (!form || !input) throw new Error(\"そんなformはない\")\r\n\r\n        form.onsubmit = (e) => {\r\n            e.preventDefault()\r\n            handler(input.value)\r\n        }\r\n    }\r\n\r\n    updateButtons() {\r\n        Array.from(this.#container.querySelectorAll(\"button\"))\r\n            .filter((b) => !b.classList.contains(\"non-page\"))\r\n            .forEach((button, i) => {\r\n                let msIn: number\r\n\r\n                if (button.hasAttribute(\"data-ms-in\")) {\r\n                    msIn = Number(button.getAttribute(\"data-ms-in\"))\r\n                }\r\n\r\n                button.onclick = () => {\r\n                    this.goto(button.dataset[\"link\"]!, {\r\n                        msIn,\r\n                        back: button.classList.contains(\"back\"),\r\n                    })\r\n                }\r\n\r\n                const back = button.getAttribute(\"data-back\")\r\n\r\n                if (back) {\r\n                    button.onclick = () => {\r\n                        this.back(Number(back), { msIn })\r\n                    }\r\n                }\r\n            })\r\n    }\r\n\r\n    async back(backDepth: number, { msIn, msOut }: FadeOption = {}) {\r\n        for (let i = 0; i < backDepth; i++) {\r\n            this.#back({\r\n                msIn: msIn,\r\n                msOut: msOut,\r\n                back: true,\r\n            })\r\n        }\r\n    }\r\n\r\n    #back(option: FadeOption) {\r\n        if (this.#currentBranch.length <= 0) return\r\n        this.#currentBranch.pop()\r\n        this.goto(this.#currentBranch.pop()!, option)\r\n    }\r\n\r\n    async goto(id: string, { msIn = this.defaultMSIn, msOut = this.defaultMSOut, back = false }: FadeOption = {}) {\r\n        if (await this.#runBefore(id)) return\r\n        this.#disableButtons()\r\n        this.#runLeft(this.#currentPageId)\r\n\r\n        const from = this.pages.get(this.#currentPageId)\r\n        const to = this.pages.get(id)\r\n\r\n        this.#currentPageId = id\r\n        this.#currentBranch.push(id)\r\n\r\n        await this.#fadeIn(msIn, from, to, back)\r\n\r\n        this.#runOn(this.#currentPageId)\r\n    }\r\n\r\n    async #fadeIn(msIn: number, from: HTMLElement | undefined, to: HTMLElement | undefined, back: boolean) {\r\n        to?.classList.remove(\"hidden\")\r\n\r\n        if (msIn > 0) {\r\n            const fromLayerNum = Number(from?.getAttribute(\"data-layer\")) || 0\r\n            const toLayerNum = Number(to?.getAttribute(\"data-layer\")) || 0\r\n\r\n            if (fromLayerNum <= toLayerNum) {\r\n                this.#fade(to, back, msIn, true)\r\n            }\r\n\r\n            if (fromLayerNum >= toLayerNum) {\r\n                this.#fade(from, back, msIn, false)\r\n            }\r\n\r\n            await Awaits.sleep(msIn)\r\n\r\n            if (fromLayerNum >= toLayerNum) {\r\n                from?.classList.add(\"hidden\")\r\n            }\r\n        }\r\n    }\r\n\r\n    #fade(page: HTMLElement | undefined, back: boolean, msIn: number, to: boolean) {\r\n        if (to) {\r\n            if (back) {\r\n                page && Awaits.exitReverse(page, msIn)\r\n            } else {\r\n                page && Awaits.enter(page, msIn)\r\n            }\r\n        } else {\r\n            if (back) {\r\n                page && Awaits.enterReverse(page, msIn)\r\n            } else {\r\n                page && Awaits.exit(page, msIn)\r\n            }\r\n        }\r\n    }\r\n\r\n    async #runBefore(id: string) {\r\n        const before = this.#beforeHandlers\r\n            .getAll(id)\r\n            .map((handler) => handler(this))\r\n            .toArray()\r\n\r\n        const p = await Promise.all(before)\r\n\r\n        return p.some(Boolean)\r\n    }\r\n\r\n    #runLeft(id: string) {\r\n        this.#leftHandlers.getAll(id).forEach((handler) => handler(this))\r\n    }\r\n\r\n    #runOn(id: string) {\r\n        requestAnimationFrame(() => {\r\n            this.#handlers.getAll(id).forEach((handler) => handler(this))\r\n            this.#ableButtons()\r\n        })\r\n    }\r\n\r\n    #disableButtons() {\r\n        this.#container.style.pointerEvents = \"none\"\r\n\r\n        this.pages.getValues().forEach((p) => (p.style.pointerEvents = \"none\"))\r\n\r\n        this.pages.getValues().forEach((page) => page.querySelectorAll(\"button\").forEach((b) => (b.disabled = true)))\r\n    }\r\n\r\n    #ableButtons() {\r\n        this.pages\r\n            .getValues()\r\n            .filter((page) => !page.classList.contains(\"hidden\"))\r\n            .forEach((page) => page.querySelectorAll(\"button\").forEach((b) => (b.disabled = false)))\r\n\r\n        this.#container.style.pointerEvents = \"\"\r\n        this.pages.getValues().forEach((p) => (p.style.pointerEvents = \"\"))\r\n    }\r\n}\r\n\r\nexport class RegExpDict<T> {\r\n    readonly #dict: Record<string, T>\r\n\r\n    constructor(dict: Record<string, T>) {\r\n        this.#dict = dict\r\n    }\r\n\r\n    get(key: string): T | undefined {\r\n        for (const [reg, value] of Object.entries(this.#dict)) {\r\n            if (new RegExp(`^${reg}$`).test(key)) {\r\n                return value\r\n            }\r\n        }\r\n    }\r\n\r\n    *getAll(key: string): Generator<T, undefined, unknown> {\r\n        for (const [reg, value] of Object.entries(this.#dict)) {\r\n            if (new RegExp(`^${reg}$`).test(key)) {\r\n                yield value\r\n            }\r\n        }\r\n    }\r\n\r\n    getKeys(): string[] {\r\n        return Object.keys(this.#dict)\r\n    }\r\n\r\n    getValues(): T[] {\r\n        return Object.values(this.#dict)\r\n    }\r\n\r\n    add(reg: string, value: T) {\r\n        this.#dict[reg] = value\r\n    }\r\n}\r\n","export abstract class Scene {\r\n    abstract readonly ready: Promise<void>\r\n    async end() {}\r\n}\r\n","import { Awaits } from \"../utils/Awaits.js\"\r\nimport { Scene } from \"./Scene.js\"\r\n\r\nexport class Scenes {\r\n    static #currentScene: Scene\r\n\r\n    static init(firstScene: Scene) {\r\n        this.#currentScene = firstScene\r\n    }\r\n\r\n    static async goto(\r\n        newScene: () => Scene,\r\n        {\r\n            showLoading = this.#showLoading,\r\n            hideLoading = this.#hideLoading,\r\n            msIn = 800,\r\n            msOut = 800,\r\n            mode = \"scale\",\r\n        }: {\r\n            showLoading?: () => void\r\n            hideLoading?: () => void\r\n            msIn?: number\r\n            msOut?: number\r\n            mode?: \"scale\" | \"fade\"\r\n        } = {},\r\n    ) {\r\n        const container = document.getElementById(\"container\")!\r\n\r\n        await this.#fadeOut(container, msIn, mode)\r\n        await this.#currentScene.end()\r\n\r\n        let done = false\r\n        let showed = false\r\n\r\n        // 1秒タイマーを並行実行\r\n        Awaits.sleep(1000).then(() => {\r\n            if (!done) {\r\n                showLoading() // ローディング画面表示\r\n                showed = true\r\n            }\r\n        })\r\n\r\n        this.#currentScene = newScene()\r\n        await this.#currentScene.ready // メイン処理実行\r\n        done = true // 1秒以内に終わればローディングは表示されない\r\n\r\n        if (showed) {\r\n            hideLoading()\r\n        }\r\n\r\n        await this.#fadeIn(container, msOut, mode)\r\n    }\r\n\r\n    static async #fadeOut(container: HTMLElement, msIn: number, mode: \"scale\" | \"fade\") {\r\n        if (msIn > 0) {\r\n            if (mode === \"scale\") {\r\n                await Awaits.exit(container, msIn)\r\n            } else if (mode === \"fade\") {\r\n                await Awaits.fadeOut(container, msIn)\r\n            }\r\n        }\r\n    }\r\n\r\n    static async #fadeIn(container: HTMLElement, msOut: number, mode: \"scale\" | \"fade\") {\r\n        if (msOut > 0) {\r\n            if (mode === \"scale\") {\r\n                await Awaits.enter(container, msOut)\r\n            } else if (mode === \"fade\") {\r\n                await Awaits.fadeIn(container, msOut)\r\n            }\r\n        }\r\n    }\r\n\r\n    static #showLoading() {\r\n        const p = document.createElement(\"p\")\r\n        p.textContent = \"Loading...\"\r\n        p.classList.add(\"loading\")\r\n        document.body.appendChild(p)\r\n    }\r\n\r\n    static #hideLoading() {\r\n        document.querySelectorAll(\".loading\").forEach((e) => e.remove())\r\n    }\r\n}\r\n","import { Dom } from \"../Dom\"\r\nimport { Awaits } from \"../utils/Awaits\"\r\nimport { Pages } from \"../utils/Pages\"\r\nimport { Scene } from \"./Scene\"\r\nimport { Scenes } from \"./Scenes\"\r\n\r\nexport class ScenePretitle extends Scene {\r\n    ready: Promise<void>\r\n\r\n    #pages = new Pages()\r\n\r\n    constructor() {\r\n        super()\r\n\r\n        this.ready = this.#setup()\r\n    }\r\n\r\n    async #setup() {\r\n        const html = await (await fetch(\"pages/pretitle.html\")).text()\r\n        await this.#pages.load(Dom.container, html)\r\n\r\n        this.#start()\r\n    }\r\n\r\n    async #start() {\r\n        await Awaits.ok()\r\n\r\n        const { SceneTitle } = await import(\"./SceneTitle\")\r\n\r\n        await Scenes.goto(() => new SceneTitle())\r\n    }\r\n}\r\n","// src/audio/BGM.ts\r\nexport class BGM {\r\n    static #context: AudioContext\r\n    static #wholeGain: GainNode\r\n\r\n    static #volume = 1\r\n    static #initialized = false\r\n\r\n    static #currentBGM: BGM | null = null\r\n\r\n    #path: string\r\n    #gain: GainNode\r\n    #ready: Promise<void>\r\n    #source: AudioBufferSourceNode | null = null\r\n    #isStarted = false\r\n\r\n    private constructor(path: string, options: { loopStartS?: number; loopEndS?: number } = {}) {\r\n        this.#path = path\r\n\r\n        this.#gain = BGM.#context.createGain()\r\n        this.#gain.connect(BGM.#wholeGain)\r\n\r\n        this.#ready = this.#localFetch(options)\r\n    }\r\n\r\n    async #localFetch(options: { loopStartS?: number; loopEndS?: number }) {\r\n        const response = await fetch(this.#path)\r\n        const arrayBuffer = await response.arrayBuffer()\r\n        const buffer = await BGM.#context.decodeAudioData(arrayBuffer)\r\n\r\n        this.#source = BGM.#context.createBufferSource()\r\n        this.#source.buffer = buffer\r\n        this.#source.loopStart = options.loopStartS ?? 0\r\n        this.#source.loopEnd = options.loopEndS ?? buffer.duration\r\n        this.#source.loop = true\r\n        this.#source.connect(this.#gain)\r\n    }\r\n\r\n    async #localFadeOut(durationMS: number) {\r\n        this.#gain.gain.cancelScheduledValues(BGM.#context.currentTime)\r\n        this.#gain.gain.linearRampToValueAtTime(0, BGM.#context.currentTime + durationMS / 1000)\r\n\r\n        await new Promise((resolve) => setTimeout(resolve, durationMS))\r\n\r\n        if (this.#isStarted) this.#source?.stop()\r\n        this.#source?.disconnect()\r\n    }\r\n\r\n    static init() {\r\n        if (this.#initialized) throw new Error(\"すでにinitialized!\")\r\n        this.#initialized = true\r\n\r\n        this.#context = new AudioContext()\r\n        this.#wholeGain = this.#context.createGain()\r\n        this.#wholeGain.connect(this.#context.destination)\r\n    }\r\n\r\n    static getPath() {\r\n        return this.#currentBGM ? this.#currentBGM.#path : \"\"\r\n    }\r\n\r\n    static async ffp(path: string, options: { loopStartS?: number; loopEndS?: number; when?: number } = {}) {\r\n        await Promise.all([this.#fadeOut(1000), this.#fetch(path, options)])\r\n\r\n        if (this.getPath() === path) {\r\n            this.#play(options.when)\r\n        }\r\n    }\r\n\r\n    static async #fetch(path: string, options: { loopStartS?: number; loopEndS?: number; when?: number }) {\r\n        this.#currentBGM = new BGM(path, options)\r\n        await this.#currentBGM.#ready\r\n    }\r\n\r\n    static #play(when?: number) {\r\n        if (!this.#currentBGM) return\r\n        this.#currentBGM.#source?.start(this.#context.currentTime + (when ?? 0))\r\n        this.#currentBGM.#isStarted = true\r\n    }\r\n\r\n    static setVolume(volume: number) {\r\n        this.#volume = volume\r\n        this.#wholeGain.gain.cancelScheduledValues(this.#context.currentTime)\r\n        this.#wholeGain.gain.value = this.#volume\r\n    }\r\n\r\n    static #fadeOut(durationMS: number) {\r\n        if (!this.#currentBGM) return\r\n        this.#currentBGM.#localFadeOut(durationMS)\r\n\r\n        return new Promise((resolve) => setTimeout(resolve, durationMS))\r\n    }\r\n\r\n    static async fade(volume: number, durationMS: number) {\r\n        this.#wholeGain.gain.cancelScheduledValues(this.#context.currentTime)\r\n        this.#wholeGain.gain.setValueAtTime(this.#volume, this.#context.currentTime)\r\n        this.#wholeGain.gain.linearRampToValueAtTime(volume, this.#context.currentTime + durationMS / 1000)\r\n\r\n        await new Promise((resolve) => setTimeout(resolve, durationMS))\r\n    }\r\n}\r\n\r\n;(window as any).BGM = BGM\r\n","export class Sound {\r\n    #audio: HTMLAudioElement\r\n\r\n    constructor(path: string, volume: number = 1) {\r\n        this.#audio = new Audio(path)\r\n        this.#audio.volume = volume\r\n    }\r\n\r\n    get duration() {\r\n        return this.#audio.duration\r\n    }\r\n\r\n    play() {\r\n        this.#audio.currentTime = 0\r\n        this.#audio.play()\r\n    }\r\n\r\n    setVolume(volume: number) {\r\n        this.#audio.volume = volume\r\n    }\r\n}\r\n\r\nexport class SE {\r\n    static voice = new Sound(\"assets/sounds/voice.wav\")\r\n    static what = new Sound(\"assets/sounds/what.wav\")\r\n    static surprised = new Sound(\"assets/sounds/surprised.wav\")\r\n    static strong = new Sound(\"assets/sounds/strong.wav\")\r\n    static say = new Sound(\"assets/sounds/say.mp3\")\r\n\r\n    static setVolume(volume: number) {\r\n        Object.values(this).forEach((se) => {\r\n            se.setVolume(volume)\r\n        })\r\n    }\r\n}\r\n","import { SE } from \"../SE\"\r\n\r\nexport class Serif {\r\n    static #container: HTMLElement\r\n    static #textArea: HTMLElement\r\n\r\n    static #texts: string[] = []\r\n\r\n    static #resolve: () => void = () => {}\r\n\r\n    static wait() {\r\n        return new Promise<void>((resolve) => {\r\n            this.#resolve = resolve\r\n        })\r\n    }\r\n\r\n    static init() {\r\n        this.#container = document.createElement(\"div\")\r\n        this.#container.id = \"serif-container\"\r\n        this.#container.classList.add(\"hidden\")\r\n\r\n        this.#textArea = document.createElement(\"div\")\r\n        this.#textArea.id = \"serif\"\r\n        this.#textArea.classList.add(\"fade-in\", \"hidden\")\r\n\r\n        this.#container.onclick = () => {\r\n            this.#say()\r\n        }\r\n\r\n        window.addEventListener(\"keydown\", (e) => {\r\n            if ([\"KeyZ\", \"Enter\", \"Space\"].includes(e.code)) {\r\n                this.#say()\r\n            }\r\n        })\r\n\r\n        this.#container.appendChild(this.#textArea)\r\n        document.body.appendChild(this.#container)\r\n    }\r\n\r\n    static hide() {\r\n        this.#container.classList.add(\"hidden\")\r\n    }\r\n\r\n    static show() {\r\n        this.#container.classList.remove(\"hidden\")\r\n        this.#textArea.classList.add(\"hidden\")\r\n    }\r\n\r\n    static say(...text: string[]) {\r\n        this.#texts = text\r\n        this.#say()\r\n        this.show()\r\n    }\r\n\r\n    static #say() {\r\n        if (this.#texts.length === 0) {\r\n            this.#container.classList.add(\"hidden\")\r\n            this.#resolve()\r\n        } else {\r\n            this.#textArea.classList.remove(\"fade-in\")\r\n\r\n            const t = this.#texts.shift() + \"\"\r\n\r\n            if (!t.endsWith(\")\")) {\r\n                this.#textArea.innerHTML = `<img src=\"assets/images/icon.png\" align=\"top\" />`\r\n            } else {\r\n                this.#textArea.innerHTML = \"\"\r\n                SE.say.play()\r\n            }\r\n\r\n            if (t.endsWith(\")\")) {\r\n            } else if (t.endsWith(\"!\")) {\r\n                SE.strong.play()\r\n            } else if (t.endsWith(\"!?\")) {\r\n                SE.surprised.play()\r\n            } else if (t.endsWith(\"?\")) {\r\n                SE.what.play()\r\n            } else {\r\n                SE.voice.play()\r\n            }\r\n\r\n            requestAnimationFrame(() => {\r\n                this.#textArea.innerHTML += `<div class=\"text-area text-end\">${t}</div>`\r\n                this.#textArea.classList.add(\"fade-in\")\r\n                this.#textArea.classList.remove(\"hidden\")\r\n            })\r\n        }\r\n    }\r\n}\r\n","import { Dom } from \"./Dom\"\r\nimport { ScenePretitle } from \"./Scenes/ScenePretitle\"\r\nimport { Scenes } from \"./Scenes/Scenes\"\r\nimport { BGM } from \"./utils/BGM\"\r\nimport { Serif } from \"./utils/Serif\"\r\n\r\nBGM.init()\r\nSerif.init()\r\nDom.init()\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    Scenes.init(new ScenePretitle())\r\n})\r\n\r\nwindow.addEventListener(\"contextmenu\", (e) => {\r\n    e.preventDefault()\r\n})\r\n"],"file":"run.js"}