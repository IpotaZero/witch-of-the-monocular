class L{static container;static init(){this.container=document.getElementById("container")}}class S{static DATA_KEY="wotm-data";static getData(){const t=localStorage.getItem(this.DATA_KEY);return t?JSON.parse(t):{}}static setData(t){localStorage.setItem(this.DATA_KEY,JSON.stringify(t))}static getChapter(){return this.getData().chapter??0}static setChapter(t){const e=this.getData();e.chapter=t,this.setData(e)}static getCurrentBranch(){return this.getData().currentBranch??[]}static setCurrentBranch(t){const e=this.getData();e.currentBranch=t,this.setData(e)}static addBranch(t){const e=this.getCurrentBranch();e.push(t),this.setCurrentBranch(e)}static getItems(){return this.getData().items??[]}static setItems(t){const e=this.getData();e.items=t,this.setData(e)}static removeItem(t){const e=this.getItems();this.setItems(e.filter(s=>s!==t))}static addItem(t){const e=this.getItems();e.includes(t)||(e.push(t),this.setItems(e))}static getFlags(){return this.getData().flags??[]}static setFlags(t){const e=this.getData();e.flags=t,this.setData(e)}static addFlag(t){const e=this.getFlags();e.push(t),this.setFlags(e)}static addClearedStageId(t){const e=this.getClearedStageId();if(!e.includes(t)){e.push(t);const s=this.getData();s.clearedStages=e,this.setData(s)}}static getClearedStageId(){return this.getData().clearedStages??[]}static getVolume(){return this.getData().volume??{bgm:9,se:9}}static setVolume(t){const e=this.getData();e.volume=t,this.setData(e)}static set isCleared(t){const e=this.getData();e.isCleared=t,this.setData(e)}static get isCleared(){return this.getData().isCleared??!1}static clear(){localStorage.removeItem(this.DATA_KEY)}}const A="modulepreload",D=function(r,t){return new URL(r,t).href},E={},k=function(t,e,s){let a=Promise.resolve();if(e&&e.length>0){let g=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};const n=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),f=l?.nonce||l?.getAttribute("nonce");a=g(e.map(c=>{if(c=D(c,s),c in E)return;E[c]=!0;const d=c.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(!!s)for(let m=n.length-1;m>=0;m--){const w=n[m];if(w.href===c&&(!d||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${y}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":A,d||(h.as="script"),h.crossOrigin="",h.href=c,f&&h.setAttribute("nonce",f),document.head.appendChild(h),d)return new Promise((m,w)=>{h.addEventListener("load",m),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(n){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=n,window.dispatchEvent(l),!l.defaultPrevented)throw n}return a.then(n=>{for(const l of n||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})};class o{static async fade(t,e=200){await this.fadeOut(t,e),this.fadeIn(t,e)}static async fadeOut(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",[...t.children].forEach(s=>s.style.pointerEvents="none"),await this.frame(()=>{t.style.opacity="1"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms`}),await this.frame(()=>{t.style.opacity="0",t.style.pointerEvents="none"}),await this.sleep(e)}static async fadeIn(t,e=200){t.style.transition="opacity 0s",t.style.pointerEvents="none",[...t.children].forEach(s=>s.style.pointerEvents="none"),await this.frame(()=>{t.style.opacity="0"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms`}),await this.frame(()=>{t.style.opacity="1",t.style.pointerEvents="",[...t.children].forEach(s=>s.style.pointerEvents="")}),await this.sleep(e)}static sleep(t){return new Promise(e=>{setTimeout(e,t)})}static ok(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{["KeyZ","Enter","Space"].includes(s.code)&&(t.abort(),e())},{signal:t.signal})})}static key(){const t=new AbortController;return new Promise(e=>{document.addEventListener("click",()=>{t.abort(),e()},{signal:t.signal}),document.addEventListener("keydown",s=>{t.abort(),e()},{signal:t.signal})})}static frame(t=()=>{}){return new Promise(e=>requestAnimationFrame(()=>{t(),e()}))}static async enter(t,e){t.style.transition="opacity 0s, scale 0s",t.style.pointerEvents="none",await this.frame(()=>{t.style.opacity="0",t.style.scale="0"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms, scale ${e}ms`}),await this.frame(()=>{t.style.opacity="1",t.style.scale="",t.style.pointerEvents=""}),await this.sleep(e),this.frame(),t.style.pointerEvents="all"}static async enterReverse(t,e){t.style.transition="opacity 0s, scale 0s",t.style.pointerEvents="none",await this.frame(()=>{t.style.opacity="1",t.style.scale="1"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms, scale ${e}ms`}),await this.frame(()=>{t.style.opacity="0",t.style.scale="0",t.style.pointerEvents=""}),await this.sleep(e),this.frame(),t.style.pointerEvents="all"}static async exit(t,e){t.style.transition="opacity 0s, scale 0s",t.style.pointerEvents="none",await this.frame(()=>{t.style.opacity="1",t.style.scale="1"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms, scale ${e}ms`}),await this.frame(()=>{t.style.opacity="0",t.style.scale="3",t.style.pointerEvents=""}),await this.sleep(e),this.frame(),t.style.pointerEvents="all"}static async exitReverse(t,e){t.style.transition="opacity 0s, scale 0s",t.style.pointerEvents="none",await this.frame(()=>{t.style.opacity="0",t.style.scale="3"}),await this.frame(()=>{t.style.transition=`opacity ${e}ms, scale ${e}ms`}),await this.frame(()=>{t.style.opacity="1",t.style.scale="",t.style.pointerEvents=""}),await this.sleep(e),this.frame(),t.style.pointerEvents="all"}}class C{defaultMSIn=700;defaultMSOut=700;pages=new v({});#t=new v({});#e=new v({});#a=new v({});#i;#s=[];#n="絶対に存在しないページID";async load(t,e,{history:s}={}){this.#i=t,this.#i.innerHTML=e;const a=s&&s.length?s.at(-1):"first";this.#s=s&&s.length?s.slice(0,-1):[],Array.from(t.querySelectorAll(".page")).forEach(i=>{this.pages.add(i.id,i),i.id!==a&&i.classList.add("hidden")}),await this.goto(a,{msIn:0,msOut:0}),this.updateButtons()}shaveBranch(t){this.#s=this.#s.slice(0,-t)}getCurrentBranch(){return[...this.#s]}on(t,e){this.#t.add(t,e)}onLeft(t,e){this.#e.add(t,e)}before(t,e){this.#a.add(t,e)}onSubmit(t,e){const s=this.pages.get(t);if(!s)throw new Error("そんなページはない");const a=s.querySelector("form"),i=s.querySelector("input");if(!a||!i)throw new Error("そんなformはない");a.onsubmit=n=>{n.preventDefault(),e(i.value)}}updateButtons(){Array.from(this.#i.querySelectorAll("button")).filter(t=>!t.classList.contains("non-page")).forEach((t,e)=>{let s;t.hasAttribute("data-ms-in")&&(s=Number(t.getAttribute("data-ms-in"))),t.onclick=()=>{this.goto(t.dataset.link,{msIn:s,back:t.classList.contains("back")})};const a=t.getAttribute("data-back");a&&(t.onclick=()=>{this.back(Number(a),{msIn:s})})})}async back(t,{msIn:e,msOut:s}={}){for(let a=0;a<t;a++)this.#l({msIn:e,msOut:s,back:!0})}#l(t){this.#s.length<=0||(this.#s.pop(),this.goto(this.#s.pop(),t))}async goto(t,{msIn:e=this.defaultMSIn,msOut:s=this.defaultMSOut,back:a=!1}={}){if(await this.#o(t))return;this.#u(),await this.#h(this.#n);const i=this.pages.get(this.#n),n=this.pages.get(t);this.#n=t,this.#s.push(t),await this.#c(e,i,n,a),this.#d(this.#n)}async#c(t,e,s,a){if(s?.classList.remove("hidden"),t>0){const i=Number(e?.getAttribute("data-layer"))||0,n=Number(s?.getAttribute("data-layer"))||0;i<=n&&this.#r(s,a,t,!0),i>=n&&this.#r(e,a,t,!1),await o.sleep(t),i>=n&&e?.classList.add("hidden")}}#r(t,e,s,a){a?e?t&&o.exitReverse(t,s):t&&o.enter(t,s):e?t&&o.enterReverse(t,s):t&&o.exit(t,s)}async#o(t){const e=this.#a.getAll(t).map(a=>a(this)).toArray();return(await Promise.all(e)).some(Boolean)}#h(t){return Promise.all(this.#e.getAll(t).map(e=>e(this)))}#d(t){requestAnimationFrame(()=>{this.#t.getAll(t).forEach(e=>e(this)),this.#f()})}#u(){this.#i.style.pointerEvents="none",this.pages.getValues().forEach(t=>t.style.pointerEvents="none"),this.pages.getValues().forEach(t=>t.querySelectorAll("button").forEach(e=>e.disabled=!0))}#f(){this.pages.getValues().filter(t=>!t.classList.contains("hidden")).forEach(t=>t.querySelectorAll("button").forEach(e=>e.disabled=!1)),this.#i.style.pointerEvents="",this.pages.getValues().forEach(t=>t.style.pointerEvents="")}}class v{#t;constructor(t){this.#t=t}get(t){for(const[e,s]of Object.entries(this.#t))if(new RegExp(`^${e}$`).test(t))return s}*getAll(t){for(const[e,s]of Object.entries(this.#t))new RegExp(`^${e}$`).test(t)&&(yield s)}getKeys(){return Object.keys(this.#t)}getValues(){return Object.values(this.#t)}add(t,e){this.#t[t]=e}}class B{async end(){}}class b{static#t;static init(t){this.#t=t}static async goto(t,{showLoading:e=this.#i,hideLoading:s=this.#s,msIn:a=800,msOut:i=800,mode:n="scale"}={}){const l=document.getElementById("container");await this.#e(l,a,n),await this.#t.end();let f=!1,g=!1;o.sleep(1e3).then(()=>{f||(e(),g=!0)}),this.#t=t(),await this.#t.ready,f=!0,g&&s(),await this.#a(l,i,n)}static async#e(t,e,s){e>0&&(s==="scale"?await o.exit(t,e):s==="fade"&&await o.fadeOut(t,e))}static async#a(t,e,s){e>0&&(s==="scale"?await o.enter(t,e):s==="fade"&&await o.fadeIn(t,e))}static#i(){const t=document.createElement("p");t.textContent="Loading...",t.classList.add("loading"),document.body.appendChild(t)}static#s(){document.querySelectorAll(".loading").forEach(t=>t.remove())}}class P extends B{ready;#t=new C;constructor(){super(),this.ready=this.#e()}async#e(){const t=await(await fetch("pages/pretitle.html")).text();await this.#t.load(L.container,t),this.#a()}async#a(){await o.ok();const{SceneTitle:t}=await k(async()=>{const{SceneTitle:e}=await import("./assets/SceneTitle-BxRnIPNJ.js").then(s=>s.S);return{SceneTitle:e}},[],import.meta.url);await b.goto(()=>new t,{mode:"fade",msOut:1e3})}}class u{#t;constructor(t,e=.5){this.#t=new Audio(t),this.#t.volume=e}get duration(){return this.#t.duration}play(){this.#t.currentTime=0,this.#t.play()}setVolume(t){this.#t.volume=t}}class p{static voice=new u("assets/sounds/voice.wav");static what=new u("assets/sounds/what.wav");static surprised=new u("assets/sounds/surprised.wav");static strong=new u("assets/sounds/strong.wav");static say=new u("assets/sounds/say.mp3");static clear=new u("assets/sounds/clear.mp3",1);static setVolume(t){Object.values(this).forEach(e=>{e.setVolume(t)})}}class I{static#t;static#e;static#a=[];static#i=()=>{};static wait(){return new Promise(t=>{this.#i=t})}static init(){this.#t=document.createElement("div"),this.#t.id="serif-container",this.#t.classList.add("hidden"),this.#e=document.createElement("div"),this.#e.id="serif",this.#e.classList.add("fade-in","hidden"),this.#t.onclick=()=>{this.#s()},window.addEventListener("keydown",t=>{["KeyZ","Enter","Space"].includes(t.code)&&this.#s()}),this.#t.appendChild(this.#e),document.body.appendChild(this.#t)}static hide(){this.#t.classList.add("hidden")}static show(){this.#t.classList.remove("hidden"),this.#e.classList.add("hidden")}static say(...t){this.#a=t,this.#s(),this.show()}static#s(){if(this.#a.length===0)this.#t.classList.add("hidden"),this.#i();else{this.#e.classList.remove("fade-in");const t=this.#a.shift()+"";t.endsWith(")")?(this.#e.innerHTML="",p.say.play()):this.#e.innerHTML='<img src="assets/images/icon.png" align="top" />',t.endsWith(")")||(t.endsWith("!")?p.strong.play():t.endsWith("!?")?p.surprised.play():t.endsWith("?")?p.what.play():p.voice.play()),requestAnimationFrame(()=>{this.#e.innerHTML+=`<div class="text-area text-end">${t}</div>`,this.#e.classList.add("fade-in"),this.#e.classList.remove("hidden")})}}}class ${static#t;static#e;static init(){this.#t=document.createElement("div"),this.#t.id="serif-container",this.#t.classList.add("hidden"),this.#e=document.createElement("div"),this.#e.id="ask",this.#e.classList.add("fade-in"),this.#t.appendChild(this.#e),document.body.appendChild(this.#t)}static hide(){this.#t.classList.add("hidden")}static show(){this.#t.classList.remove("hidden")}static ask(t){this.show(),this.#e.innerHTML="";const e=t.map(s=>{const a=document.createElement("button");return a.textContent=s,a.classList.add("question-button"),this.#e.appendChild(a),a});return new Promise(s=>{e.forEach((a,i)=>{a.onclick=()=>{s(t[i]),this.hide()}})})}}$.init();I.init();L.init();document.addEventListener("DOMContentLoaded",()=>{new URLSearchParams(window.location.search).get("delete")==="true"&&S.clear(),b.init(new P)});window.addEventListener("contextmenu",r=>{r.preventDefault()});export{$ as A,L as D,S as L,C as P,B as S,k as _,I as a,b,p as c,o as d};
//# sourceMappingURL=run.js.map
